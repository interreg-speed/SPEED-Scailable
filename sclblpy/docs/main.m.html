<!doctype html>
<head>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, minimum-scale=1" />

    <title>main API documentation</title>
    <meta name="description" content="" />

  <link href='http://fonts.googleapis.com/css?family=Source+Sans+Pro:400,300' rel='stylesheet' type='text/css'>
  
  <style type="text/css">
  
* {
  box-sizing: border-box;
}
/*! normalize.css v1.1.1 | MIT License | git.io/normalize */

/* ==========================================================================
   HTML5 display definitions
   ========================================================================== */

/**
 * Correct `block` display not defined in IE 6/7/8/9 and Firefox 3.
 */

article,
aside,
details,
figcaption,
figure,
footer,
header,
hgroup,
main,
nav,
section,
summary {
    display: block;
}

/**
 * Correct `inline-block` display not defined in IE 6/7/8/9 and Firefox 3.
 */

audio,
canvas,
video {
    display: inline-block;
    *display: inline;
    *zoom: 1;
}

/**
 * Prevent modern browsers from displaying `audio` without controls.
 * Remove excess height in iOS 5 devices.
 */

audio:not([controls]) {
    display: none;
    height: 0;
}

/**
 * Address styling not present in IE 7/8/9, Firefox 3, and Safari 4.
 * Known issue: no IE 6 support.
 */

[hidden] {
    display: none;
}

/* ==========================================================================
   Base
   ========================================================================== */

/**
 * 1. Prevent system color scheme's background color being used in Firefox, IE,
 *    and Opera.
 * 2. Prevent system color scheme's text color being used in Firefox, IE, and
 *    Opera.
 * 3. Correct text resizing oddly in IE 6/7 when body `font-size` is set using
 *    `em` units.
 * 4. Prevent iOS text size adjust after orientation change, without disabling
 *    user zoom.
 */

html {
    background: #fff; /* 1 */
    color: #000; /* 2 */
    font-size: 100%; /* 3 */
    -webkit-text-size-adjust: 100%; /* 4 */
    -ms-text-size-adjust: 100%; /* 4 */
}

/**
 * Address `font-family` inconsistency between `textarea` and other form
 * elements.
 */

html,
button,
input,
select,
textarea {
    font-family: sans-serif;
}

/**
 * Address margins handled incorrectly in IE 6/7.
 */

body {
    margin: 0;
}

/* ==========================================================================
   Links
   ========================================================================== */

/**
 * Address `outline` inconsistency between Chrome and other browsers.
 */

a:focus {
    outline: thin dotted;
}

/**
 * Improve readability when focused and also mouse hovered in all browsers.
 */

a:active,
a:hover {
    outline: 0;
}

/* ==========================================================================
   Typography
   ========================================================================== */

/**
 * Address font sizes and margins set differently in IE 6/7.
 * Address font sizes within `section` and `article` in Firefox 4+, Safari 5,
 * and Chrome.
 */

h1 {
    font-size: 2em;
    margin: 0.67em 0;
}

h2 {
    font-size: 1.5em;
    margin: 0.83em 0;
}

h3 {
    font-size: 1.17em;
    margin: 1em 0;
}

h4 {
    font-size: 1em;
    margin: 1.33em 0;
}

h5 {
    font-size: 0.83em;
    margin: 1.67em 0;
}

h6 {
    font-size: 0.67em;
    margin: 2.33em 0;
}

/**
 * Address styling not present in IE 7/8/9, Safari 5, and Chrome.
 */

abbr[title] {
    border-bottom: 1px dotted;
}

/**
 * Address style set to `bolder` in Firefox 3+, Safari 4/5, and Chrome.
 */

b,
strong {
    font-weight: bold;
}

blockquote {
    margin: 1em 40px;
}

/**
 * Address styling not present in Safari 5 and Chrome.
 */

dfn {
    font-style: italic;
}

/**
 * Address differences between Firefox and other browsers.
 * Known issue: no IE 6/7 normalization.
 */

hr {
    -moz-box-sizing: content-box;
    box-sizing: content-box;
    height: 0;
}

/**
 * Address styling not present in IE 6/7/8/9.
 */

mark {
    background: #ff0;
    color: #000;
}

/**
 * Address margins set differently in IE 6/7.
 */

p,
pre {
    margin: 1em 0;
}

/**
 * Correct font family set oddly in IE 6, Safari 4/5, and Chrome.
 */

code,
kbd,
pre,
samp {
    font-family: monospace, serif;
    _font-family: 'courier new', monospace;
    font-size: 1em;
}

/**
 * Improve readability of pre-formatted text in all browsers.
 */

pre {
    white-space: pre;
    white-space: pre-wrap;
    word-wrap: break-word;
}

/**
 * Address CSS quotes not supported in IE 6/7.
 */

q {
    quotes: none;
}

/**
 * Address `quotes` property not supported in Safari 4.
 */

q:before,
q:after {
    content: '';
    content: none;
}

/**
 * Address inconsistent and variable font size in all browsers.
 */

small {
    font-size: 80%;
}

/**
 * Prevent `sub` and `sup` affecting `line-height` in all browsers.
 */

sub,
sup {
    font-size: 75%;
    line-height: 0;
    position: relative;
    vertical-align: baseline;
}

sup {
    top: -0.5em;
}

sub {
    bottom: -0.25em;
}

/* ==========================================================================
   Lists
   ========================================================================== */

/**
 * Address margins set differently in IE 6/7.
 */

dl,
menu,
ol,
ul {
    margin: 1em 0;
}

dd {
    margin: 0 0 0 40px;
}

/**
 * Address paddings set differently in IE 6/7.
 */

menu,
ol,
ul {
    padding: 0 0 0 40px;
}

/**
 * Correct list images handled incorrectly in IE 7.
 */

nav ul,
nav ol {
    list-style: none;
    list-style-image: none;
}

/* ==========================================================================
   Embedded content
   ========================================================================== */

/**
 * 1. Remove border when inside `a` element in IE 6/7/8/9 and Firefox 3.
 * 2. Improve image quality when scaled in IE 7.
 */

img {
    border: 0; /* 1 */
    -ms-interpolation-mode: bicubic; /* 2 */
}

/**
 * Correct overflow displayed oddly in IE 9.
 */

svg:not(:root) {
    overflow: hidden;
}

/* ==========================================================================
   Figures
   ========================================================================== */

/**
 * Address margin not present in IE 6/7/8/9, Safari 5, and Opera 11.
 */

figure {
    margin: 0;
}

/* ==========================================================================
   Forms
   ========================================================================== */

/**
 * Correct margin displayed oddly in IE 6/7.
 */

form {
    margin: 0;
}

/**
 * Define consistent border, margin, and padding.
 */

fieldset {
    border: 1px solid #c0c0c0;
    margin: 0 2px;
    padding: 0.35em 0.625em 0.75em;
}

/**
 * 1. Correct color not being inherited in IE 6/7/8/9.
 * 2. Correct text not wrapping in Firefox 3.
 * 3. Correct alignment displayed oddly in IE 6/7.
 */

legend {
    border: 0; /* 1 */
    padding: 0;
    white-space: normal; /* 2 */
    *margin-left: -7px; /* 3 */
}

/**
 * 1. Correct font size not being inherited in all browsers.
 * 2. Address margins set differently in IE 6/7, Firefox 3+, Safari 5,
 *    and Chrome.
 * 3. Improve appearance and consistency in all browsers.
 */

button,
input,
select,
textarea {
    font-size: 100%; /* 1 */
    margin: 0; /* 2 */
    vertical-align: baseline; /* 3 */
    *vertical-align: middle; /* 3 */
}

/**
 * Address Firefox 3+ setting `line-height` on `input` using `!important` in
 * the UA stylesheet.
 */

button,
input {
    line-height: normal;
}

/**
 * Address inconsistent `text-transform` inheritance for `button` and `select`.
 * All other form control elements do not inherit `text-transform` values.
 * Correct `button` style inheritance in Chrome, Safari 5+, and IE 6+.
 * Correct `select` style inheritance in Firefox 4+ and Opera.
 */

button,
select {
    text-transform: none;
}

/**
 * 1. Avoid the WebKit bug in Android 4.0.* where (2) destroys native `audio`
 *    and `video` controls.
 * 2. Correct inability to style clickable `input` types in iOS.
 * 3. Improve usability and consistency of cursor style between image-type
 *    `input` and others.
 * 4. Remove inner spacing in IE 7 without affecting normal text inputs.
 *    Known issue: inner spacing remains in IE 6.
 */

button,
html input[type="button"], /* 1 */
input[type="reset"],
input[type="submit"] {
    -webkit-appearance: button; /* 2 */
    cursor: pointer; /* 3 */
    *overflow: visible;  /* 4 */
}

/**
 * Re-set default cursor for disabled elements.
 */

button[disabled],
html input[disabled] {
    cursor: default;
}

/**
 * 1. Address box sizing set to content-box in IE 8/9.
 * 2. Remove excess padding in IE 8/9.
 * 3. Remove excess padding in IE 7.
 *    Known issue: excess padding remains in IE 6.
 */

input[type="checkbox"],
input[type="radio"] {
    box-sizing: border-box; /* 1 */
    padding: 0; /* 2 */
    *height: 13px; /* 3 */
    *width: 13px; /* 3 */
}

/**
 * 1. Address `appearance` set to `searchfield` in Safari 5 and Chrome.
 * 2. Address `box-sizing` set to `border-box` in Safari 5 and Chrome
 *    (include `-moz` to future-proof).
 */

input[type="search"] {
    -webkit-appearance: textfield; /* 1 */
    -moz-box-sizing: content-box;
    -webkit-box-sizing: content-box; /* 2 */
    box-sizing: content-box;
}

/**
 * Remove inner padding and search cancel button in Safari 5 and Chrome
 * on OS X.
 */

input[type="search"]::-webkit-search-cancel-button,
input[type="search"]::-webkit-search-decoration {
    -webkit-appearance: none;
}

/**
 * Remove inner padding and border in Firefox 3+.
 */

button::-moz-focus-inner,
input::-moz-focus-inner {
    border: 0;
    padding: 0;
}

/**
 * 1. Remove default vertical scrollbar in IE 6/7/8/9.
 * 2. Improve readability and alignment in all browsers.
 */

textarea {
    overflow: auto; /* 1 */
    vertical-align: top; /* 2 */
}

/* ==========================================================================
   Tables
   ========================================================================== */

/**
 * Remove most spacing between table cells.
 */

table {
    border-collapse: collapse;
    border-spacing: 0;
}

  </style>

  <style type="text/css">
  
  html, body {
    margin: 0;
    padding: 0;
    min-height: 100%;
  }
  body {
    background: #fff;
    font-family: "Source Sans Pro", "Helvetica Neueue", Helvetica, sans;
    font-weight: 300;
    font-size: 16px;
    line-height: 1.6em;
  }
  #content {
    width: 70%;
    max-width: 850px;
    float: left;
    padding: 30px 60px;
    border-left: 1px solid #ddd;
  }
  #sidebar {
    width: 25%;
    float: left;
    padding: 30px;
    overflow: hidden;
  }
  #nav {
    font-size: 130%;
    margin: 0 0 15px 0;
  }

  #top {
    display: block;
    position: fixed;
    bottom: 5px;
    left: 5px;
    font-size: .85em;
    text-transform: uppercase;
  }

  #footer {
    font-size: .75em;
    padding: 5px 30px;
    border-top: 1px solid #ddd;
    text-align: right;
  }
    #footer p {
      margin: 0 0 0 30px;
      display: inline-block;
    }

  h1, h2, h3, h4, h5 {
    font-weight: 300;
  }
  h1 {
    font-size: 2.5em;
    line-height: 1.1em;
    margin: 0 0 .50em 0;
  }

  h2 {
    font-size: 1.75em;
    margin: 1em 0 .50em 0;
  }

  h3 {
    margin: 25px 0 10px 0;
  }

  h4 {
    margin: 0;
    font-size: 105%;
  }

  a {
    color: #058;
    text-decoration: none;
    transition: color .3s ease-in-out;
  }

  a:hover {
    color: #e08524;
    transition: color .3s ease-in-out;
  }

  pre, code, .mono, .name {
    font-family: "Ubuntu Mono", "Cousine", "DejaVu Sans Mono", monospace;
  }

  .title .name {
    font-weight: bold;
  }
  .section-title {
    margin-top: 2em;
  }
  .ident {
    color: #900;
  }

  code {
    background: #f9f9f9;
  } 

  pre {
    background: #fefefe;
    border: 1px solid #ddd;
    box-shadow: 2px 2px 0 #f3f3f3;
    margin: 0 30px;
    padding: 15px 30px;
  }

  .codehilite {
    margin: 0 30px 10px 30px;
  }

    .codehilite pre {
      margin: 0;
    }
    .codehilite .err { background: #ff3300; color: #fff !important; } 

  table#module-list {
    font-size: 110%;
  }

    table#module-list tr td:first-child {
      padding-right: 10px;
      white-space: nowrap;
    }

    table#module-list td {
      vertical-align: top;
      padding-bottom: 8px;
    }

      table#module-list td p {
        margin: 0 0 7px 0;
      }

  .def {
    display: table;
  }

    .def p {
      display: table-cell;
      vertical-align: top;
      text-align: left;
    }

    .def p:first-child {
      white-space: nowrap;
    }

    .def p:last-child {
      width: 100%;
    }


  #index {
    list-style-type: none;
    margin: 0;
    padding: 0;
  }
    ul#index .class_name {
      /* font-size: 110%; */
      font-weight: bold;
    }
    #index ul {
      margin: 0;
    }

  .item {
    margin: 0 0 15px 0;
  }

    .item .class {
      margin: 0 0 25px 30px;
    }

      .item .class ul.class_list {
        margin: 0 0 20px 0;
      }

    .item .name {
      background: #fafafa;
      margin: 0;
      font-weight: bold;
      padding: 5px 10px;
      border-radius: 3px;
      display: inline-block;
      min-width: 40%;
    }
      .item .name:hover {
        background: #f6f6f6;
      }

    .item .empty_desc {
      margin: 0 0 5px 0;
      padding: 0;
    }

    .item .inheritance {
      margin: 3px 0 0 30px;
    }

    .item .inherited {
      color: #666;
    }

    .item .desc {
      padding: 0 8px;
      margin: 0;
    }

      .item .desc p {
        margin: 0 0 10px 0;
      }

    .source_cont {
      margin: 0;
      padding: 0;
    }

    .source_link a {
      background: #ffc300;
      font-weight: 400;
      font-size: .75em;
      text-transform: uppercase;
      color: #fff;
      text-shadow: 1px 1px 0 #f4b700;
      
      padding: 3px 8px;
      border-radius: 2px;
      transition: background .3s ease-in-out;
    }
      .source_link a:hover {
        background: #FF7200;
        text-shadow: none;
        transition: background .3s ease-in-out;
      }

    .source {
      display: none;
      max-height: 600px;
      overflow-y: scroll;
      margin-bottom: 15px;
    }

      .source .codehilite {
        margin: 0;
      }

  .desc h1, .desc h2, .desc h3 {
    font-size: 100% !important;
  }
  .clear {
    clear: both;
  }

  @media all and (max-width: 950px) {
    #sidebar {
      width: 35%;
    }
    #content {
      width: 65%;
    }
  }
  @media all and (max-width: 650px) {
    #top {
      display: none;
    }
    #sidebar {
      float: none;
      width: auto;
    }
    #content {
      float: none;
      width: auto;
      padding: 30px;
    }

    #index ul {
      padding: 0;
      margin-bottom: 15px;
    }
    #index ul li {
      display: inline-block;
      margin-right: 30px;
    }
    #footer {
      text-align: left;
    }
    #footer p {
      display: block;
      margin: inherit;
    }
  }

  /*****************************/

  </style>

  <style type="text/css">
  .codehilite .hll { background-color: #ffffcc }
.codehilite  { background: #f8f8f8; }
.codehilite .c { color: #408080; font-style: italic } /* Comment */
.codehilite .err { border: 1px solid #FF0000 } /* Error */
.codehilite .k { color: #008000; font-weight: bold } /* Keyword */
.codehilite .o { color: #666666 } /* Operator */
.codehilite .ch { color: #408080; font-style: italic } /* Comment.Hashbang */
.codehilite .cm { color: #408080; font-style: italic } /* Comment.Multiline */
.codehilite .cp { color: #BC7A00 } /* Comment.Preproc */
.codehilite .cpf { color: #408080; font-style: italic } /* Comment.PreprocFile */
.codehilite .c1 { color: #408080; font-style: italic } /* Comment.Single */
.codehilite .cs { color: #408080; font-style: italic } /* Comment.Special */
.codehilite .gd { color: #A00000 } /* Generic.Deleted */
.codehilite .ge { font-style: italic } /* Generic.Emph */
.codehilite .gr { color: #FF0000 } /* Generic.Error */
.codehilite .gh { color: #000080; font-weight: bold } /* Generic.Heading */
.codehilite .gi { color: #00A000 } /* Generic.Inserted */
.codehilite .go { color: #888888 } /* Generic.Output */
.codehilite .gp { color: #000080; font-weight: bold } /* Generic.Prompt */
.codehilite .gs { font-weight: bold } /* Generic.Strong */
.codehilite .gu { color: #800080; font-weight: bold } /* Generic.Subheading */
.codehilite .gt { color: #0044DD } /* Generic.Traceback */
.codehilite .kc { color: #008000; font-weight: bold } /* Keyword.Constant */
.codehilite .kd { color: #008000; font-weight: bold } /* Keyword.Declaration */
.codehilite .kn { color: #008000; font-weight: bold } /* Keyword.Namespace */
.codehilite .kp { color: #008000 } /* Keyword.Pseudo */
.codehilite .kr { color: #008000; font-weight: bold } /* Keyword.Reserved */
.codehilite .kt { color: #B00040 } /* Keyword.Type */
.codehilite .m { color: #666666 } /* Literal.Number */
.codehilite .s { color: #BA2121 } /* Literal.String */
.codehilite .na { color: #7D9029 } /* Name.Attribute */
.codehilite .nb { color: #008000 } /* Name.Builtin */
.codehilite .nc { color: #0000FF; font-weight: bold } /* Name.Class */
.codehilite .no { color: #880000 } /* Name.Constant */
.codehilite .nd { color: #AA22FF } /* Name.Decorator */
.codehilite .ni { color: #999999; font-weight: bold } /* Name.Entity */
.codehilite .ne { color: #D2413A; font-weight: bold } /* Name.Exception */
.codehilite .nf { color: #0000FF } /* Name.Function */
.codehilite .nl { color: #A0A000 } /* Name.Label */
.codehilite .nn { color: #0000FF; font-weight: bold } /* Name.Namespace */
.codehilite .nt { color: #008000; font-weight: bold } /* Name.Tag */
.codehilite .nv { color: #19177C } /* Name.Variable */
.codehilite .ow { color: #AA22FF; font-weight: bold } /* Operator.Word */
.codehilite .w { color: #bbbbbb } /* Text.Whitespace */
.codehilite .mb { color: #666666 } /* Literal.Number.Bin */
.codehilite .mf { color: #666666 } /* Literal.Number.Float */
.codehilite .mh { color: #666666 } /* Literal.Number.Hex */
.codehilite .mi { color: #666666 } /* Literal.Number.Integer */
.codehilite .mo { color: #666666 } /* Literal.Number.Oct */
.codehilite .sa { color: #BA2121 } /* Literal.String.Affix */
.codehilite .sb { color: #BA2121 } /* Literal.String.Backtick */
.codehilite .sc { color: #BA2121 } /* Literal.String.Char */
.codehilite .dl { color: #BA2121 } /* Literal.String.Delimiter */
.codehilite .sd { color: #BA2121; font-style: italic } /* Literal.String.Doc */
.codehilite .s2 { color: #BA2121 } /* Literal.String.Double */
.codehilite .se { color: #BB6622; font-weight: bold } /* Literal.String.Escape */
.codehilite .sh { color: #BA2121 } /* Literal.String.Heredoc */
.codehilite .si { color: #BB6688; font-weight: bold } /* Literal.String.Interpol */
.codehilite .sx { color: #008000 } /* Literal.String.Other */
.codehilite .sr { color: #BB6688 } /* Literal.String.Regex */
.codehilite .s1 { color: #BA2121 } /* Literal.String.Single */
.codehilite .ss { color: #19177C } /* Literal.String.Symbol */
.codehilite .bp { color: #008000 } /* Name.Builtin.Pseudo */
.codehilite .fm { color: #0000FF } /* Name.Function.Magic */
.codehilite .vc { color: #19177C } /* Name.Variable.Class */
.codehilite .vg { color: #19177C } /* Name.Variable.Global */
.codehilite .vi { color: #19177C } /* Name.Variable.Instance */
.codehilite .vm { color: #19177C } /* Name.Variable.Magic */
.codehilite .il { color: #666666 } /* Literal.Number.Integer.Long */
  </style>

  <style type="text/css">
  
/* ==========================================================================
   EXAMPLE Media Queries for Responsive Design.
   These examples override the primary ('mobile first') styles.
   Modify as content requires.
   ========================================================================== */

@media only screen and (min-width: 35em) {
    /* Style adjustments for viewports that meet the condition */
}

@media print,
       (-o-min-device-pixel-ratio: 5/4),
       (-webkit-min-device-pixel-ratio: 1.25),
       (min-resolution: 120dpi) {
    /* Style adjustments for high resolution devices */
}

/* ==========================================================================
   Print styles.
   Inlined to avoid required HTTP connection: h5bp.com/r
   ========================================================================== */

@media print {
    * {
        background: transparent !important;
        color: #000 !important; /* Black prints faster: h5bp.com/s */
        box-shadow: none !important;
        text-shadow: none !important;
    }

    a,
    a:visited {
        text-decoration: underline;
    }

    a[href]:after {
        content: " (" attr(href) ")";
    }

    abbr[title]:after {
        content: " (" attr(title) ")";
    }

    /*
     * Don't show links for images, or javascript/internal links
     */

    .ir a:after,
    a[href^="javascript:"]:after,
    a[href^="#"]:after {
        content: "";
    }

    pre,
    blockquote {
        border: 1px solid #999;
        page-break-inside: avoid;
    }

    thead {
        display: table-header-group; /* h5bp.com/t */
    }

    tr,
    img {
        page-break-inside: avoid;
    }

    img {
        max-width: 100% !important;
    }

    @page {
        margin: 0.5cm;
    }

    p,
    h2,
    h3 {
        orphans: 3;
        widows: 3;
    }

    h2,
    h3 {
        page-break-after: avoid;
    }
}

  </style>

  <script type="text/javascript">
  function toggle(id, $link) {
    $node = document.getElementById(id);
    if (!$node)
    return;
    if (!$node.style.display || $node.style.display == 'none') {
    $node.style.display = 'block';
    $link.innerHTML = 'Hide source &nequiv;';
    } else {
    $node.style.display = 'none';
    $link.innerHTML = 'Show source &equiv;';
    }
  }
  </script>
</head>
<body>
<a href="#" id="top">Top</a>

<div id="container">
    
  
  <div id="sidebar">
    <h1>Index</h1>
    <ul id="index">

    <li class="set"><h3><a href="#header-functions">Functions</a></h3>
      
  <ul>
    <li class="mono"><a href="#main.delete_endpoint">delete_endpoint</a></li>
    <li class="mono"><a href="#main.endpoints">endpoints</a></li>
    <li class="mono"><a href="#main.list_models">list_models</a></li>
    <li class="mono"><a href="#main.remove_credentials">remove_credentials</a></li>
    <li class="mono"><a href="#main.start_print">start_print</a></li>
    <li class="mono"><a href="#main.stop_print">stop_print</a></li>
    <li class="mono"><a href="#main.update">update</a></li>
    <li class="mono"><a href="#main.update_docs">update_docs</a></li>
    <li class="mono"><a href="#main.upload">upload</a></li>
  </ul>

    </li>


    </ul>
  </div>

    <article id="content">
      
  

  


  <header id="section-intro">
  <h1 class="title"><span class="name">main</span> module</h1>
  
  
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-main', this);">Show source &equiv;</a></p>
  <div id="source-main" class="source">
    <div class="codehilite"><pre><span></span><span class="c1"># File contains all public methods of the scblpy package</span>
<span class="kn">import</span> <span class="nn">json</span>
<span class="kn">import</span> <span class="nn">requests</span>

<span class="kn">import</span> <span class="nn">sclblpy._globals</span> <span class="k">as</span> <span class="nn">glob</span>
<span class="kn">from</span> <span class="nn">sclblpy._bundle</span> <span class="kn">import</span> <span class="n">_gzip_save</span><span class="p">,</span> <span class="n">_gzip_delete</span>
<span class="kn">from</span> <span class="nn">sclblpy._jwt</span> <span class="kn">import</span> <span class="n">_check_jwt</span><span class="p">,</span> <span class="n">_remove_credentials</span>
<span class="kn">from</span> <span class="nn">sclblpy._utils</span> <span class="kn">import</span> <span class="n">_get_model_name</span><span class="p">,</span> <span class="n">_get_system_info</span><span class="p">,</span> <span class="n">_predict</span><span class="p">,</span> <span class="n">_get_model_package</span><span class="p">,</span> <span class="n">_load_supported_models</span><span class="p">,</span> \
    <span class="n">_check_model</span>
<span class="kn">from</span> <span class="nn">sclblpy.errors</span> <span class="kn">import</span> <span class="n">UserManagerError</span><span class="p">,</span> <span class="n">JWTError</span><span class="p">,</span> <span class="n">UploadModelError</span>
<span class="kn">from</span> <span class="nn">sclblpy.version</span> <span class="kn">import</span> <span class="n">__version__</span>


<span class="k">def</span> <span class="nf">upload</span><span class="p">(</span><span class="n">mod</span><span class="p">,</span> <span class="n">feature_vector</span><span class="p">,</span> <span class="n">docs</span><span class="o">=</span><span class="p">{},</span> <span class="n">email</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">_keep</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;Uploads a fitted model to Scailable.</span>

<span class="sd">    The upload function is the main workhorse of the sclblpy package.</span>
<span class="sd">    The function first checks whether the supplied model is ok (part of the list and fitted).</span>

<span class="sd">    Next, it checks whether an example row is provided and if so it creates the example</span>
<span class="sd">    input and output .json objects.</span>

<span class="sd">    Next, the docs are checked; if none are provided a warning is issued and a simple</span>
<span class="sd">    name is provided based on the model type.</span>

<span class="sd">    Subsequently, we package the whole thing, including details of the user system, into a</span>
<span class="sd">    gzipped file that is stored on disc.</span>

<span class="sd">    Finally the whole package is uploaded to the toolchain.</span>

<span class="sd">    Note: This method prints user-feedback by default. This feedback can be suppressed by calling the</span>
<span class="sd">        stop_print() method.</span>

<span class="sd">    Args:</span>
<span class="sd">        mod: The model to be uploaded.</span>
<span class="sd">        feature_vector: An example feature_vector for your model.</span>
<span class="sd">            (i.e., the first row of your training data X obtained using row = X[0,:])</span>
<span class="sd">        docs: A dict{} containing the fields &#39;name&#39; and &#39;documentation&#39;</span>
<span class="sd">        email: Bool indicating whether a confirmation email of a successful conversion should be send. Default True.</span>
<span class="sd">        _keep: Bool indicating whether the .gzipped file should be retained. Default False.</span>

<span class="sd">    Returns:</span>
<span class="sd">        False if upload failed, true otherwise</span>

<span class="sd">    Raises  (in debug mode):</span>
<span class="sd">        UploadModelError if unable to successfully bundle and upload the model.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">bundle</span> <span class="o">=</span> <span class="p">{}</span>

    <span class="c1"># Check model:</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">_check_model</span><span class="p">(</span><span class="n">mod</span><span class="p">):</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">glob</span><span class="o">.</span><span class="n">SILENT</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;FATAL: The model you are trying to upload is not (yet) supported or has not been fitted. </span><span class="se">\n</span><span class="s2">&quot;</span>
                  <span class="s2">&quot;Please see README.md for a list of supported models. </span><span class="se">\n</span><span class="s2">&quot;</span>
                  <span class="s2">&quot;Your models has not been uploaded. </span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">glob</span><span class="o">.</span><span class="n">DEBUG</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">UploadModelError</span><span class="p">(</span><span class="s2">&quot;The uploaded model is not supported.&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="kc">False</span>
    <span class="n">bundle</span><span class="p">[</span><span class="s1">&#39;fitted_model&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">mod</span>

    <span class="c1"># check input vector and generate an example:</span>
    <span class="n">bundle</span><span class="p">[</span><span class="s1">&#39;example&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">if</span> <span class="n">feature_vector</span><span class="o">.</span><span class="n">any</span><span class="p">():</span>
        <span class="c1"># try prediction</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">output</span> <span class="o">=</span> <span class="n">_predict</span><span class="p">(</span><span class="n">mod</span><span class="p">,</span> <span class="n">feature_vector</span><span class="p">)</span>  <span class="c1"># predict raises error if unable to generate predcition</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">glob</span><span class="o">.</span><span class="n">SILENT</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;FATAL: We were unable to create an example inference. </span><span class="se">\n</span><span class="s2">&quot;</span>
                      <span class="s2">&quot;Your model has not been uploaded. </span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">glob</span><span class="o">.</span><span class="n">DEBUG</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">UploadModelError</span><span class="p">(</span><span class="s2">&quot;Unable to generate prediction: &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">))</span>
            <span class="k">return</span> <span class="kc">False</span>
        <span class="c1"># format data:</span>
        <span class="n">input_str</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;[[</span><span class="si">%s</span><span class="s1">]]&#39;</span> <span class="o">%</span> <span class="s1">&#39;, &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">feature_vector</span><span class="o">.</span><span class="n">tolist</span><span class="p">()])</span>
        <span class="n">example</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;input&#39;</span><span class="p">:</span> <span class="n">input_str</span><span class="p">,</span> <span class="s2">&quot;output&quot;</span><span class="p">:</span> <span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">output</span><span class="p">)}</span>
        <span class="n">bundle</span><span class="p">[</span><span class="s1">&#39;example&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">example</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">glob</span><span class="o">.</span><span class="n">SILENT</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;FATAL: You did not provide a required example instance. (see docs). </span><span class="se">\n</span><span class="s2">&quot;</span>
                  <span class="s2">&quot;Your model has not been uploaded. </span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="kc">False</span>

    <span class="c1"># check the docs:</span>
    <span class="n">bundle</span><span class="p">[</span><span class="s1">&#39;docs&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">if</span> <span class="n">docs</span><span class="p">:</span>
        <span class="n">bundle</span><span class="p">[</span><span class="s1">&#39;docs&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">docs</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">try</span><span class="p">:</span>  <span class="c1"># This should work, but catching the exception just in case:</span>
            <span class="n">name</span> <span class="o">=</span> <span class="n">_get_model_name</span><span class="p">(</span><span class="n">mod</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
            <span class="n">name</span> <span class="o">=</span> <span class="s2">&quot;NAMELESS MODEL&quot;</span>
        <span class="n">bundle</span><span class="p">[</span><span class="s1">&#39;docs&#39;</span><span class="p">][</span><span class="s1">&#39;name&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">name</span>
        <span class="n">bundle</span><span class="p">[</span><span class="s1">&#39;docs&#39;</span><span class="p">][</span><span class="s1">&#39;documentation&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;-- EMPTY --&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">glob</span><span class="o">.</span><span class="n">SILENT</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;WARNING: You did not provide any documentation. </span><span class="se">\n</span><span class="s2">&quot;</span>
                  <span class="s2">&quot;We will simply use &quot;</span> <span class="o">+</span> <span class="n">name</span> <span class="o">+</span> <span class="s2">&quot; as its name without further documentation.&quot;</span><span class="p">)</span>

    <span class="c1"># check authorization:</span>
    <span class="n">auth</span> <span class="o">=</span> <span class="n">_check_jwt</span><span class="p">()</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">auth</span><span class="p">:</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">glob</span><span class="o">.</span><span class="n">SILENT</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;FATAL: We were unable to obtain JWT authorization for your account. </span><span class="se">\n</span><span class="s2">&quot;</span>
                  <span class="s2">&quot;Your model has not been uploaded. </span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">glob</span><span class="o">.</span><span class="n">DEBUG</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">UploadModelError</span><span class="p">(</span><span class="s2">&quot;We were unable to obtain JWT authorization.&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="kc">False</span>

    <span class="c1"># get system information</span>
    <span class="n">bundle</span><span class="p">[</span><span class="s1">&#39;system_info&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">_get_system_info</span><span class="p">()</span>

    <span class="c1"># gzip the bundle</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">_gzip_save</span><span class="p">(</span><span class="n">bundle</span><span class="p">):</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">glob</span><span class="o">.</span><span class="n">SILENT</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;FATAL: We were unable to gzip your model bundle. </span><span class="se">\n</span><span class="s2">&quot;</span>
                  <span class="s2">&quot;Your model has not been uploaded. </span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">glob</span><span class="o">.</span><span class="n">DEBUG</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">UploadModelError</span><span class="p">(</span><span class="s2">&quot;We were unable to save the bundle.&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="kc">False</span>

    <span class="c1"># all ok, upload:</span>
    <span class="k">if</span> <span class="n">auth</span><span class="p">:</span>

        <span class="n">url</span> <span class="o">=</span> <span class="n">glob</span><span class="o">.</span><span class="n">TOOLCHAIN_URL</span> <span class="o">+</span> <span class="s2">&quot;/upload/&quot;</span> <span class="o">+</span> <span class="n">glob</span><span class="o">.</span><span class="n">JWT_USER_ID</span>

        <span class="c1"># Map python package to the right toolchain:</span>
        <span class="n">pkg_name</span> <span class="o">=</span> <span class="n">_get_model_package</span><span class="p">(</span><span class="n">mod</span><span class="p">)</span>
        <span class="n">toolchain_name</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
        <span class="k">if</span> <span class="n">pkg_name</span> <span class="o">==</span> <span class="s2">&quot;sklearn&quot;</span><span class="p">:</span>
            <span class="n">toolchain_name</span> <span class="o">=</span> <span class="s2">&quot;sklearn&quot;</span>
        <span class="k">elif</span> <span class="n">pkg_name</span> <span class="o">==</span> <span class="s2">&quot;statsmodels&quot;</span><span class="p">:</span>
            <span class="n">toolchain_name</span> <span class="o">=</span> <span class="s2">&quot;sklearn&quot;</span>
        <span class="k">elif</span> <span class="n">pkg_name</span> <span class="o">==</span> <span class="s2">&quot;xgboost&quot;</span><span class="p">:</span>
            <span class="n">toolchain_name</span> <span class="o">=</span> <span class="s2">&quot;sklearn&quot;</span>
        <span class="k">elif</span> <span class="n">pkg_name</span> <span class="o">==</span> <span class="s2">&quot;lightgbm&quot;</span><span class="p">:</span>
            <span class="n">toolchain_name</span> <span class="o">=</span> <span class="s2">&quot;sklearn&quot;</span>

        <span class="c1"># Setup the actual request</span>
        <span class="n">data</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s1">&#39;email&#39;</span><span class="p">:</span> <span class="n">email</span><span class="p">,</span>
            <span class="s1">&#39;package&#39;</span><span class="p">:</span> <span class="n">__version__</span><span class="p">,</span>
            <span class="s1">&#39;toolchain&#39;</span><span class="p">:</span> <span class="n">toolchain_name</span><span class="p">,</span>
            <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="n">bundle</span><span class="p">[</span><span class="s1">&#39;docs&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;name&#39;</span><span class="p">,</span> <span class="s2">&quot;No name found.&quot;</span><span class="p">),</span>
            <span class="s1">&#39;docs&#39;</span><span class="p">:</span> <span class="n">bundle</span><span class="p">[</span><span class="s1">&#39;docs&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;documentation&#39;</span><span class="p">,</span> <span class="s2">&quot;No docs provided.&quot;</span><span class="p">),</span>
            <span class="s1">&#39;exampleInput&#39;</span><span class="p">:</span> <span class="n">bundle</span><span class="p">[</span><span class="s1">&#39;example&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;input&#39;</span><span class="p">,</span> <span class="s2">&quot;[]&quot;</span><span class="p">),</span>
            <span class="s1">&#39;exampleOutput&#39;</span><span class="p">:</span> <span class="n">bundle</span><span class="p">[</span><span class="s1">&#39;example&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;output&#39;</span><span class="p">,</span> <span class="s2">&quot;[]&quot;</span><span class="p">)</span>
        <span class="p">}</span>
        <span class="n">payload</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s1">&#39;data&#39;</span><span class="p">:</span> <span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
        <span class="p">}</span>

        <span class="n">files</span> <span class="o">=</span> <span class="p">[(</span><span class="s1">&#39;bundle&#39;</span><span class="p">,</span> <span class="nb">open</span><span class="p">(</span><span class="n">glob</span><span class="o">.</span><span class="n">GZIP_BUNDLE</span><span class="p">,</span> <span class="s1">&#39;rb&#39;</span><span class="p">))]</span>
        <span class="n">headers</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s1">&#39;Authorization&#39;</span><span class="p">:</span> <span class="n">glob</span><span class="o">.</span><span class="n">JWT_TOKEN</span>
        <span class="p">}</span>

        <span class="c1"># Do the request (and make sure to delete the gzip if errors occur)</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">response</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">post</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">headers</span><span class="o">=</span><span class="n">headers</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">payload</span><span class="p">,</span> <span class="n">files</span><span class="o">=</span><span class="n">files</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">glob</span><span class="o">.</span><span class="n">SILENT</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;FATAL: Unable to carry out the upload request: the toolchain is not available. </span><span class="se">\n</span><span class="s2">&quot;</span>
                      <span class="s2">&quot;Your model has not been uploaded. </span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">_keep</span><span class="p">:</span>
                <span class="n">_gzip_delete</span><span class="p">()</span>
            <span class="k">if</span> <span class="n">glob</span><span class="o">.</span><span class="n">DEBUG</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">UploadModelError</span><span class="p">(</span><span class="s2">&quot;We were unable to obtain JWT authorization: &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">))</span>
            <span class="k">return</span> <span class="kc">False</span>

        <span class="c1"># Error handling</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">response_data</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">text</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">glob</span><span class="o">.</span><span class="n">SILENT</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;FATAL: We did not receive a valid JSON response from the toolchain-server. </span><span class="se">\n</span><span class="s2">&quot;</span>
                      <span class="s2">&quot;Your model has not been uploaded. </span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">_keep</span><span class="p">:</span>
                <span class="n">_gzip_delete</span><span class="p">()</span>
            <span class="k">if</span> <span class="n">glob</span><span class="o">.</span><span class="n">DEBUG</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">UploadModelError</span><span class="p">(</span><span class="s2">&quot;We did not receive a valid response from the server: &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">))</span>
            <span class="k">return</span> <span class="kc">False</span>

        <span class="k">if</span> <span class="n">response_data</span><span class="p">[</span><span class="s1">&#39;error&#39;</span><span class="p">]:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">glob</span><span class="o">.</span><span class="n">SILENT</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;FATAL: An error was returned by the server. </span><span class="se">\n</span><span class="s2">&quot;</span>
                      <span class="s2">&quot;Your model has not been uploaded. </span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">_keep</span><span class="p">:</span>
                <span class="n">_gzip_delete</span><span class="p">()</span>
            <span class="k">if</span> <span class="n">glob</span><span class="o">.</span><span class="n">DEBUG</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">UploadModelError</span><span class="p">(</span><span class="s2">&quot;We did not receive a valid response from the server: &quot;</span> <span class="o">+</span> <span class="n">response_data</span><span class="p">[</span><span class="s1">&#39;error&#39;</span><span class="p">])</span>
            <span class="k">return</span> <span class="kc">False</span>

        <span class="k">if</span> <span class="n">glob</span><span class="o">.</span><span class="n">DEBUG</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;The following content has been send to the toolchain server:&quot;</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="n">bundle</span><span class="p">)</span>

        <span class="c1"># user feedback:</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">glob</span><span class="o">.</span><span class="n">SILENT</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Your model was successfully uploaded. </span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="c1"># remove bundle:</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">_keep</span><span class="p">:</span>
            <span class="n">_gzip_delete</span><span class="p">()</span>

        <span class="k">return</span> <span class="kc">True</span>

    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="kc">False</span>


<span class="k">def</span> <span class="nf">update</span><span class="p">(</span><span class="n">mod</span><span class="p">,</span> <span class="n">feature_vector</span><span class="p">,</span> <span class="n">cfid</span><span class="p">,</span> <span class="n">docs</span><span class="o">=</span><span class="p">{},</span> <span class="n">email</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">_keep</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;Updates an already existing model.</span>

<span class="sd">    The update function is similar to the upload function in most respects (so, see its docs),</span>
<span class="sd">    but instead of creating a new endpoint it overwrites the docs and model of an already exisitng</span>
<span class="sd">    endpoint. Thus, there is an additional argument &quot;cfid&quot; providing the computeFunction Id</span>
<span class="sd">    of the endpoint that needs to be updated. Use sp.list_models() to get a list of your already</span>
<span class="sd">    existing endpoints.</span>

<span class="sd">    Note: If you solely want to change the documentation of an endpoint, you can either use the</span>
<span class="sd">        update_docs() function or the online admin interface at https://admin.sclble.net.</span>

<span class="sd">    Args:</span>
<span class="sd">        mod: The model to be uploaded.</span>
<span class="sd">        feature_vector: An example feature_vector for your model.</span>
<span class="sd">            (i.e., the first row of your training data X obtained using row = X[0,:])</span>
<span class="sd">        cfid: a string with a valid computeFunction ID.</span>
<span class="sd">        docs: A dict{} containing the fields &#39;name&#39; and &#39;documentation&#39;. Default {}.</span>
<span class="sd">        email: Bool indicating whether a confirmation email of a successful conversion should be send. Default True.</span>
<span class="sd">        _keep: Bool indicating whether the .gzipped file should be retained. Default False.</span>

<span class="sd">    Returns:</span>
<span class="sd">        False if upload failed, true otherwise</span>

<span class="sd">    Raises  (in debug mode):</span>
<span class="sd">        UploadModelError if unable to successfully bundle and upload the model.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">bundle</span> <span class="o">=</span> <span class="p">{}</span>

    <span class="c1"># Check model:</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">_check_model</span><span class="p">(</span><span class="n">mod</span><span class="p">):</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">glob</span><span class="o">.</span><span class="n">SILENT</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;FATAL: The model you are trying to upload is not (yet) supported or has not been fitted. </span><span class="se">\n</span><span class="s2">&quot;</span>
                  <span class="s2">&quot;Please see README.md for a list of supported models. </span><span class="se">\n</span><span class="s2">&quot;</span>
                  <span class="s2">&quot;Your models has not been uploaded. </span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">glob</span><span class="o">.</span><span class="n">DEBUG</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">UploadModelError</span><span class="p">(</span><span class="s2">&quot;The submitted model is not supported.&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="kc">False</span>
    <span class="n">bundle</span><span class="p">[</span><span class="s1">&#39;fitted_model&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">mod</span>

    <span class="c1"># check input vector and generate an example:</span>
    <span class="n">bundle</span><span class="p">[</span><span class="s1">&#39;example&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">if</span> <span class="n">feature_vector</span><span class="o">.</span><span class="n">any</span><span class="p">():</span>
        <span class="c1"># try prediction</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">output</span> <span class="o">=</span> <span class="n">_predict</span><span class="p">(</span><span class="n">mod</span><span class="p">,</span> <span class="n">feature_vector</span><span class="p">)</span>  <span class="c1"># predict raises error if unable to generate predcition</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">glob</span><span class="o">.</span><span class="n">SILENT</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;FATAL: We were unable to create an example inference. </span><span class="se">\n</span><span class="s2">&quot;</span>
                      <span class="s2">&quot;Your model has not been updated. </span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">glob</span><span class="o">.</span><span class="n">DEBUG</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">UploadModelError</span><span class="p">(</span><span class="s2">&quot;Unable to generate prediction: &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">))</span>
            <span class="k">return</span> <span class="kc">False</span>
        <span class="c1"># format data:</span>
        <span class="n">input_str</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;[[</span><span class="si">%s</span><span class="s1">]]&#39;</span> <span class="o">%</span> <span class="s1">&#39;, &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">feature_vector</span><span class="o">.</span><span class="n">tolist</span><span class="p">()])</span>
        <span class="n">example</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;input&#39;</span><span class="p">:</span> <span class="n">input_str</span><span class="p">,</span> <span class="s2">&quot;output&quot;</span><span class="p">:</span> <span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">output</span><span class="p">)}</span>
        <span class="n">bundle</span><span class="p">[</span><span class="s1">&#39;example&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">example</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">glob</span><span class="o">.</span><span class="n">SILENT</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;FATAL: You did not provide a required example instance. (see docs). </span><span class="se">\n</span><span class="s2">&quot;</span>
                  <span class="s2">&quot;Your model has not been updated. </span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="kc">False</span>

    <span class="c1"># check the docs:</span>
    <span class="n">bundle</span><span class="p">[</span><span class="s1">&#39;docs&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="n">docs_update</span> <span class="o">=</span> <span class="kc">True</span>
    <span class="k">if</span> <span class="n">docs</span><span class="p">:</span>
        <span class="n">bundle</span><span class="p">[</span><span class="s1">&#39;docs&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">docs</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">docs_update</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">glob</span><span class="o">.</span><span class="n">SILENT</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;WARNING: You did not provide any documentation. </span><span class="se">\n</span><span class="s2">&quot;</span>
                  <span class="s2">&quot;We will only update the .wasm model, not the documentation.&quot;</span><span class="p">)</span>

    <span class="c1"># check authorization:</span>
    <span class="n">auth</span> <span class="o">=</span> <span class="n">_check_jwt</span><span class="p">()</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">auth</span><span class="p">:</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">glob</span><span class="o">.</span><span class="n">SILENT</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;FATAL: We were unable to obtain JWT authorization for your account. </span><span class="se">\n</span><span class="s2">&quot;</span>
                  <span class="s2">&quot;Your model has not been updated. </span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">glob</span><span class="o">.</span><span class="n">DEBUG</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">UploadModelError</span><span class="p">(</span><span class="s2">&quot;We were unable to obtain JWT authorization.&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="kc">False</span>

    <span class="c1"># get system information</span>
    <span class="n">bundle</span><span class="p">[</span><span class="s1">&#39;system_info&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">_get_system_info</span><span class="p">()</span>

    <span class="c1"># gzip the bundle</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">_gzip_save</span><span class="p">(</span><span class="n">bundle</span><span class="p">):</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">glob</span><span class="o">.</span><span class="n">SILENT</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;FATAL: We were unable to gzip your model bundle. </span><span class="se">\n</span><span class="s2">&quot;</span>
                  <span class="s2">&quot;Your model has not been updated. </span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">glob</span><span class="o">.</span><span class="n">DEBUG</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">UploadModelError</span><span class="p">(</span><span class="s2">&quot;We were unable to save the bundle.&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="kc">False</span>

    <span class="c1"># all ok, upload:</span>
    <span class="k">if</span> <span class="n">auth</span><span class="p">:</span>

        <span class="n">url</span> <span class="o">=</span> <span class="n">glob</span><span class="o">.</span><span class="n">TOOLCHAIN_URL</span> <span class="o">+</span> <span class="s2">&quot;/upload/&quot;</span> <span class="o">+</span> <span class="n">glob</span><span class="o">.</span><span class="n">JWT_USER_ID</span> <span class="o">+</span> <span class="s2">&quot;/&quot;</span> <span class="o">+</span> <span class="n">cfid</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>

        <span class="c1"># Map python package to the right toolchain:</span>
        <span class="n">pkg_name</span> <span class="o">=</span> <span class="n">_get_model_package</span><span class="p">(</span><span class="n">mod</span><span class="p">)</span>
        <span class="n">toolchain_name</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
        <span class="k">if</span> <span class="n">pkg_name</span> <span class="o">==</span> <span class="s2">&quot;sklearn&quot;</span><span class="p">:</span>
            <span class="n">toolchain_name</span> <span class="o">=</span> <span class="s2">&quot;sklearn&quot;</span>
        <span class="k">elif</span> <span class="n">pkg_name</span> <span class="o">==</span> <span class="s2">&quot;statsmodels&quot;</span><span class="p">:</span>
            <span class="n">toolchain_name</span> <span class="o">=</span> <span class="s2">&quot;sklearn&quot;</span>
        <span class="k">elif</span> <span class="n">pkg_name</span> <span class="o">==</span> <span class="s2">&quot;xgboost&quot;</span><span class="p">:</span>
            <span class="n">toolchain_name</span> <span class="o">=</span> <span class="s2">&quot;sklearn&quot;</span>
        <span class="k">elif</span> <span class="n">pkg_name</span> <span class="o">==</span> <span class="s2">&quot;lightgbm&quot;</span><span class="p">:</span>
            <span class="n">toolchain_name</span> <span class="o">=</span> <span class="s2">&quot;sklearn&quot;</span>

        <span class="c1"># Setup the actual request</span>
        <span class="n">data</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s1">&#39;email&#39;</span><span class="p">:</span> <span class="n">email</span><span class="p">,</span>
            <span class="s1">&#39;package&#39;</span><span class="p">:</span> <span class="n">__version__</span><span class="p">,</span>
            <span class="s1">&#39;toolchain&#39;</span><span class="p">:</span> <span class="n">toolchain_name</span><span class="p">,</span>
            <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="n">bundle</span><span class="p">[</span><span class="s1">&#39;docs&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;name&#39;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">),</span>
            <span class="s1">&#39;docs&#39;</span><span class="p">:</span> <span class="n">bundle</span><span class="p">[</span><span class="s1">&#39;docs&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;documentation&#39;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">),</span>
            <span class="s1">&#39;updateDocs&#39;</span><span class="p">:</span> <span class="n">docs_update</span><span class="p">,</span>
            <span class="s1">&#39;exampleInput&#39;</span><span class="p">:</span> <span class="n">bundle</span><span class="p">[</span><span class="s1">&#39;example&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;input&#39;</span><span class="p">,</span> <span class="s2">&quot;[]&quot;</span><span class="p">),</span>
            <span class="s1">&#39;exampleOutput&#39;</span><span class="p">:</span> <span class="n">bundle</span><span class="p">[</span><span class="s1">&#39;example&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;output&#39;</span><span class="p">,</span> <span class="s2">&quot;[]&quot;</span><span class="p">)</span>
        <span class="p">}</span>
        <span class="n">payload</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s1">&#39;data&#39;</span><span class="p">:</span> <span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
        <span class="p">}</span>

        <span class="nb">print</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>

        <span class="n">files</span> <span class="o">=</span> <span class="p">[(</span><span class="s1">&#39;bundle&#39;</span><span class="p">,</span> <span class="nb">open</span><span class="p">(</span><span class="n">glob</span><span class="o">.</span><span class="n">GZIP_BUNDLE</span><span class="p">,</span> <span class="s1">&#39;rb&#39;</span><span class="p">))]</span>
        <span class="n">headers</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s1">&#39;Authorization&#39;</span><span class="p">:</span> <span class="n">glob</span><span class="o">.</span><span class="n">JWT_TOKEN</span>
        <span class="p">}</span>

        <span class="c1"># Do the request (and make sure to delete the gzip if errors occur)</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">response</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">put</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">headers</span><span class="o">=</span><span class="n">headers</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">payload</span><span class="p">,</span> <span class="n">files</span><span class="o">=</span><span class="n">files</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">glob</span><span class="o">.</span><span class="n">SILENT</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;FATAL: Unable to carry out the upload request: the toolchain is not available. </span><span class="se">\n</span><span class="s2">&quot;</span>
                      <span class="s2">&quot;Your model has not been updated. </span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">_keep</span><span class="p">:</span>
                <span class="n">_gzip_delete</span><span class="p">()</span>
            <span class="k">if</span> <span class="n">glob</span><span class="o">.</span><span class="n">DEBUG</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">UploadModelError</span><span class="p">(</span><span class="s2">&quot;We were unable to obtain JWT authorization: &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">))</span>
            <span class="k">return</span> <span class="kc">False</span>

        <span class="c1"># Error handling</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">response_data</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">text</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">glob</span><span class="o">.</span><span class="n">SILENT</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;FATAL: We did not receive a valid JSON response from the toolchain-server. </span><span class="se">\n</span><span class="s2">&quot;</span>
                      <span class="s2">&quot;Your model has not been updated. </span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">_keep</span><span class="p">:</span>
                <span class="n">_gzip_delete</span><span class="p">()</span>
            <span class="k">if</span> <span class="n">glob</span><span class="o">.</span><span class="n">DEBUG</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">UploadModelError</span><span class="p">(</span><span class="s2">&quot;We did not receive a valid response from the server: &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">))</span>
            <span class="k">return</span> <span class="kc">False</span>

        <span class="k">if</span> <span class="n">response_data</span><span class="p">[</span><span class="s1">&#39;error&#39;</span><span class="p">]:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">glob</span><span class="o">.</span><span class="n">SILENT</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;FATAL: An error was returned by the server. </span><span class="se">\n</span><span class="s2">&quot;</span>
                      <span class="s2">&quot;Your model has not been updated. </span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">_keep</span><span class="p">:</span>
                <span class="n">_gzip_delete</span><span class="p">()</span>
            <span class="k">if</span> <span class="n">glob</span><span class="o">.</span><span class="n">DEBUG</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">UploadModelError</span><span class="p">(</span><span class="s2">&quot;We did not receive a valid response from the server: &quot;</span> <span class="o">+</span> <span class="n">response_data</span><span class="p">[</span><span class="s1">&#39;error&#39;</span><span class="p">])</span>
            <span class="k">return</span> <span class="kc">False</span>

        <span class="k">if</span> <span class="n">glob</span><span class="o">.</span><span class="n">DEBUG</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;The following content has been send to the toolchain server:&quot;</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="n">bundle</span><span class="p">)</span>

        <span class="c1"># user feedback:</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">glob</span><span class="o">.</span><span class="n">SILENT</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Your model was successfully submitted for an update. </span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="c1"># remove bundle:</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">_keep</span><span class="p">:</span>
            <span class="n">_gzip_delete</span><span class="p">()</span>

        <span class="k">return</span> <span class="kc">True</span>

    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="kc">False</span>


<span class="k">def</span> <span class="nf">update_docs</span><span class="p">(</span><span class="n">cfid</span><span class="p">,</span> <span class="n">docs</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;Updates the documentation of an already existing model</span>

<span class="sd">    The update_docs function can be used to upload the documentation of an already existing model</span>
<span class="sd">    by simply providing the cfid and the new docs object.</span>

<span class="sd">    Args:</span>
<span class="sd">        cfid: a string with a valid computeFunction ID.</span>
<span class="sd">        docs: A dict{} containing the fields &#39;name&#39; and &#39;documentation&#39;</span>

<span class="sd">    Returns:</span>
<span class="sd">        False if upload failed, true otherwise</span>

<span class="sd">    Raises  (in debug mode):</span>
<span class="sd">        UploadModelError if unable to successfully bundle and upload the model.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># check the docs:</span>
    <span class="n">name</span> <span class="o">=</span> <span class="n">docs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;name&#39;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">name</span> <span class="o">==</span> <span class="s2">&quot;&quot;</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;FATAL: Please make sure to add a name to your documentation (using the &#39;name&#39;) field </span><span class="se">\n</span><span class="s2">&quot;</span>
              <span class="s2">&quot;Your model documentation has not been updated. </span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="kc">False</span>
    <span class="n">documentation</span> <span class="o">=</span> <span class="n">docs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;documentation&#39;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">documentation</span> <span class="o">==</span> <span class="s2">&quot;&quot;</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;FATAL: Please make sure to your documentation (using the &#39;documentation&#39; field) </span><span class="se">\n</span><span class="s2">&quot;</span>
              <span class="s2">&quot;Your model documentation has not been updated. </span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="kc">False</span>

    <span class="c1"># check authorization:</span>
    <span class="n">auth</span> <span class="o">=</span> <span class="n">_check_jwt</span><span class="p">()</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">auth</span><span class="p">:</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">glob</span><span class="o">.</span><span class="n">SILENT</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;FATAL: We were unable to obtain JWT authorization for your account. </span><span class="se">\n</span><span class="s2">&quot;</span>
                  <span class="s2">&quot;Your model has not been uploaded. </span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">glob</span><span class="o">.</span><span class="n">DEBUG</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">UploadModelError</span><span class="p">(</span><span class="s2">&quot;We were unable to obtain JWT authorization.&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="kc">False</span>

    <span class="c1"># all ok, upload:</span>
    <span class="k">if</span> <span class="n">auth</span><span class="p">:</span>

        <span class="n">url</span> <span class="o">=</span> <span class="n">glob</span><span class="o">.</span><span class="n">USER_MANAGER_URL</span> <span class="o">+</span> <span class="s2">&quot;/compute-function/&quot;</span> <span class="o">+</span> <span class="n">glob</span><span class="o">.</span><span class="n">JWT_USER_ID</span> <span class="o">+</span> <span class="s2">&quot;/&quot;</span> <span class="o">+</span> <span class="n">cfid</span>

        <span class="c1"># Setup the actual request</span>
        <span class="n">data</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;language&quot;</span><span class="p">:</span> <span class="s2">&quot;WASM&quot;</span><span class="p">,</span>
            <span class="s2">&quot;public&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
            <span class="s2">&quot;profit&quot;</span><span class="p">:</span> <span class="mf">0.1</span><span class="p">,</span>
            <span class="s2">&quot;cycles&quot;</span><span class="p">:</span> <span class="mf">1.0</span><span class="p">,</span>
            <span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="n">name</span><span class="p">,</span>
            <span class="s2">&quot;docs&quot;</span><span class="p">:</span> <span class="n">documentation</span>
        <span class="p">}</span>
        <span class="n">payload</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s1">&#39;data&#39;</span><span class="p">:</span> <span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
        <span class="p">}</span>

        <span class="n">files</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">headers</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s1">&#39;Authorization&#39;</span><span class="p">:</span> <span class="n">glob</span><span class="o">.</span><span class="n">JWT_TOKEN</span>
        <span class="p">}</span>

        <span class="c1"># Do the request (and make sure to delete the gzip if errors occur)</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">response</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">put</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">headers</span><span class="o">=</span><span class="n">headers</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">payload</span><span class="p">,</span> <span class="n">files</span><span class="o">=</span><span class="n">files</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">glob</span><span class="o">.</span><span class="n">SILENT</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;FATAL: Unable to carry out the upload request: the toolchain is not available. </span><span class="se">\n</span><span class="s2">&quot;</span>
                      <span class="s2">&quot;Your model documentation has not been updated. </span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">glob</span><span class="o">.</span><span class="n">DEBUG</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">UploadModelError</span><span class="p">(</span><span class="s2">&quot;We were unable to obtain JWT authorization: &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">))</span>
            <span class="k">return</span> <span class="kc">False</span>

        <span class="c1"># Error handling</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">response_data</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">text</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">glob</span><span class="o">.</span><span class="n">SILENT</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;FATAL: We did not receive a valid JSON response from the toolchain-server. </span><span class="se">\n</span><span class="s2">&quot;</span>
                      <span class="s2">&quot;Your model documentation has not been updated. </span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">glob</span><span class="o">.</span><span class="n">DEBUG</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">UploadModelError</span><span class="p">(</span><span class="s2">&quot;We did not receive a valid response from the server: &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">))</span>
            <span class="k">return</span> <span class="kc">False</span>

        <span class="k">if</span> <span class="n">response_data</span><span class="p">[</span><span class="s1">&#39;error&#39;</span><span class="p">]:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">glob</span><span class="o">.</span><span class="n">SILENT</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;FATAL: An error was returned by the server. </span><span class="se">\n</span><span class="s2">&quot;</span>
                      <span class="s2">&quot;Your model documentation has not been updated. </span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">glob</span><span class="o">.</span><span class="n">DEBUG</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">UploadModelError</span><span class="p">(</span><span class="s2">&quot;We did not receive a valid response from the server: &quot;</span> <span class="o">+</span> <span class="n">response_data</span><span class="p">[</span><span class="s1">&#39;error&#39;</span><span class="p">])</span>
            <span class="k">return</span> <span class="kc">False</span>

        <span class="k">if</span> <span class="n">glob</span><span class="o">.</span><span class="n">DEBUG</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;The documentation for &quot;</span> <span class="o">+</span> <span class="n">cfid</span> <span class="o">+</span> <span class="s2">&quot; has been updated using:&quot;</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>

        <span class="c1"># user feedback:</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">glob</span><span class="o">.</span><span class="n">SILENT</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Your model documentation has been updated. </span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="kc">True</span>

    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="kc">False</span>


<span class="k">def</span> <span class="nf">endpoints</span><span class="p">(</span><span class="n">_verbose</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;Return the endpoints available for the current user.</span>

<span class="sd">    Using the global JWT string this function returns a dict</span>
<span class="sd">    of the endpoints by the current user.</span>

<span class="sd">    Args:</span>
<span class="sd">        _verbose: Bool indicating whether the endpoints should be printed. Default True.</span>

<span class="sd">    Returns:</span>
<span class="sd">         endpoints: a list containing all the endpoints by the current user. [{},{},{}]</span>

<span class="sd">    Raises (in debug mode):</span>
<span class="sd">        JWTError if unable to obtain JWT authorization</span>
<span class="sd">        UserManagerError if unable to retrieve endpoint details</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">_check_jwt</span><span class="p">()</span>
    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">glob</span><span class="o">.</span><span class="n">SILENT</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;We were unable to renew your JWT lease. </span><span class="se">\n</span><span class="s2">&quot;</span>
                  <span class="s2">&quot;If this recurs use the remove_credentials() function to reset your login credentials.&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">glob</span><span class="o">.</span><span class="n">DEBUG</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">JWTError</span><span class="p">(</span><span class="s2">&quot;Unable to check JWT authorization. &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">))</span>
        <span class="k">return</span> <span class="kc">False</span>

    <span class="n">url</span> <span class="o">=</span> <span class="n">glob</span><span class="o">.</span><span class="n">USER_MANAGER_URL</span> <span class="o">+</span> <span class="s2">&quot;/compute-functions/&quot;</span> <span class="o">+</span> <span class="n">glob</span><span class="o">.</span><span class="n">JWT_USER_ID</span>
    <span class="n">headers</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s1">&#39;Authorization&#39;</span><span class="p">:</span> <span class="n">glob</span><span class="o">.</span><span class="n">JWT_TOKEN</span>
    <span class="p">}</span>

    <span class="k">try</span><span class="p">:</span>
        <span class="n">response</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">request</span><span class="p">(</span><span class="s2">&quot;GET&quot;</span><span class="p">,</span> <span class="n">url</span><span class="p">,</span> <span class="n">headers</span><span class="o">=</span><span class="n">headers</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="p">{})</span>
        <span class="n">result</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">text</span><span class="p">)</span>
    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">glob</span><span class="o">.</span><span class="n">SILENT</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;We were unable retrieve your endpoints. </span><span class="se">\n</span><span class="s2">&quot;</span>
                  <span class="s2">&quot;Please try again later.&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">glob</span><span class="o">.</span><span class="n">DEBUG</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">UserManagerError</span><span class="p">(</span><span class="s2">&quot;Unable to retrieve endpoints. &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">))</span>
        <span class="k">return</span> <span class="kc">False</span>

    <span class="c1"># print if requested:</span>
    <span class="k">if</span> <span class="n">_verbose</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">glob</span><span class="o">.</span><span class="n">SILENT</span><span class="p">:</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">result</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;You currently do not own any active endpoints.&quot;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;You currently own the following endpoints:&quot;</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">result</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Name: </span><span class="si">{}</span><span class="s1">, cfid: </span><span class="si">{}</span><span class="s1">.&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">key</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">],</span> <span class="n">key</span><span class="p">[</span><span class="s1">&#39;cfid&#39;</span><span class="p">]))</span>

    <span class="k">return</span> <span class="n">result</span>


<span class="k">def</span> <span class="nf">delete_endpoint</span><span class="p">(</span><span class="n">cfid</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;Deletes an endpoint by cfid.</span>

<span class="sd">    Delete an endpoint owned by the currently logged in user by cfid.</span>

<span class="sd">    Args:</span>
<span class="sd">        cfid: String of the compute function id.</span>

<span class="sd">    Returns:</span>
<span class="sd">        True if successful, False otherwise.</span>

<span class="sd">    Raises  (in debug mode):</span>
<span class="sd">        JWTError if unable to obtain JWT authorization</span>
<span class="sd">        UserManagerError if unable to delete endpoints</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">_check_jwt</span><span class="p">()</span>
    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">glob</span><span class="o">.</span><span class="n">SILENT</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;We were unable to renew your JWT lease. </span><span class="se">\n</span><span class="s2">&quot;</span>
                  <span class="s2">&quot;If this recurs use the remove_credentials() function to reset your login credentials.&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">glob</span><span class="o">.</span><span class="n">DEBUG</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">JWTError</span><span class="p">(</span><span class="s2">&quot;Unable to check JWT authorization. &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">))</span>
        <span class="k">return</span> <span class="kc">False</span>

    <span class="n">url</span> <span class="o">=</span> <span class="n">glob</span><span class="o">.</span><span class="n">USER_MANAGER_URL</span> <span class="o">+</span> <span class="s2">&quot;/compute-function/&quot;</span> <span class="o">+</span> <span class="n">glob</span><span class="o">.</span><span class="n">JWT_USER_ID</span> <span class="o">+</span> <span class="s2">&quot;/&quot;</span> <span class="o">+</span> <span class="n">cfid</span>
    <span class="n">headers</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s1">&#39;Authorization&#39;</span><span class="p">:</span> <span class="n">glob</span><span class="o">.</span><span class="n">JWT_TOKEN</span>
    <span class="p">}</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">response</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">request</span><span class="p">(</span><span class="s2">&quot;DELETE&quot;</span><span class="p">,</span> <span class="n">url</span><span class="p">,</span> <span class="n">headers</span><span class="o">=</span><span class="n">headers</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="p">{})</span>
        <span class="c1"># Check if content type is JSON</span>
        <span class="k">if</span> <span class="s1">&#39;json&#39;</span> <span class="ow">in</span> <span class="n">response</span><span class="o">.</span><span class="n">headers</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;Content-Type&#39;</span><span class="p">):</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">result</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">text</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>  <span class="c1"># simplejson.decoder.JSONDecodeError</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">glob</span><span class="o">.</span><span class="n">SILENT</span><span class="p">:</span>
                    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Unable to decode JSON response from usermanager error.&quot;</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">glob</span><span class="o">.</span><span class="n">DEBUG</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="n">UserManagerError</span><span class="p">(</span><span class="n">result</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;Unable to decode JSON response from usermanager error.&quot;</span><span class="p">))</span>
                <span class="k">return</span> <span class="kc">False</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">glob</span><span class="o">.</span><span class="n">SILENT</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Server at&quot;</span><span class="p">,</span> <span class="n">glob</span><span class="o">.</span><span class="n">USER_MANAGER_URL</span><span class="p">,</span> <span class="s2">&quot;did not return a valid JSON document.&quot;</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">glob</span><span class="o">.</span><span class="n">DEBUG</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">UserManagerError</span><span class="p">(</span><span class="s2">&quot;Server at&quot;</span><span class="p">,</span> <span class="n">glob</span><span class="o">.</span><span class="n">USER_MANAGER_URL</span><span class="p">,</span> <span class="s2">&quot;did not return a valid JSON document.&quot;</span><span class="p">)</span>
            <span class="k">return</span> <span class="kc">False</span>
    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">glob</span><span class="o">.</span><span class="n">SILENT</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;We were unable to remove this endpoint from the server. </span><span class="se">\n</span><span class="s2">&quot;</span>
                  <span class="s2">&quot;Please try again later.&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">glob</span><span class="o">.</span><span class="n">DEBUG</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">UserManagerError</span><span class="p">(</span><span class="s2">&quot;Unable to delete endpoint. &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">))</span>
        <span class="k">return</span> <span class="kc">False</span>

    <span class="k">if</span> <span class="n">result</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;error&quot;</span><span class="p">)</span> <span class="o">!=</span> <span class="s2">&quot;&quot;</span><span class="p">:</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">glob</span><span class="o">.</span><span class="n">SILENT</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;We were unable to remove this endpoint: </span><span class="se">\n</span><span class="s2">&quot;</span>
                  <span class="s2">&quot;Server error: &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">result</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;error&quot;</span><span class="p">)))</span>
        <span class="k">if</span> <span class="n">glob</span><span class="o">.</span><span class="n">DEBUG</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">UserManagerError</span><span class="p">(</span><span class="s2">&quot;Unable to delete endpoint. &quot;</span> <span class="o">+</span> <span class="n">result</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;error&quot;</span><span class="p">))</span>
        <span class="k">return</span> <span class="kc">False</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="n">glob</span><span class="o">.</span><span class="n">SILENT</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Endpoint with cfid &quot;</span> <span class="o">+</span> <span class="n">cfid</span> <span class="o">+</span> <span class="s2">&quot; was successfully deleted.&quot;</span><span class="p">)</span>

    <span class="k">return</span> <span class="kc">True</span>


<span class="k">def</span> <span class="nf">remove_credentials</span><span class="p">(</span><span class="n">_verbose</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;Remove your stored credentials.</span>

<span class="sd">    Remove the .creds.json file that stores the username and password</span>
<span class="sd">    of the current user.</span>

<span class="sd">    Args:</span>
<span class="sd">        _verbose: Boolean indicator whether or not feedback should be printed. Default False.</span>

<span class="sd">    Returns:</span>
<span class="sd">        True is user credentials are found and deleted. False otherwise (often because they were not found).</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># actual function in _utils.py to prevent circular includes.</span>
    <span class="n">removed</span> <span class="o">=</span> <span class="n">_remove_credentials</span><span class="p">()</span>
    <span class="k">if</span> <span class="n">removed</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">_verbose</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">glob</span><span class="o">.</span><span class="n">SILENT</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Successfully removed your user credentials.&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="kc">True</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">_verbose</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">glob</span><span class="o">.</span><span class="n">SILENT</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;No user credentials found.&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="kc">False</span>


<span class="k">def</span> <span class="nf">stop_print</span><span class="p">(</span><span class="n">_verbose</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;Stop ALL printing of user feedback from package.</span>

<span class="sd">    Args:</span>
<span class="sd">        _verbose: Boolean indicator whether or not feedback should be printed. Default False.</span>

<span class="sd">    Returns:</span>
<span class="sd">        True</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">_verbose</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Printing user feedback set to &#39;False&#39;.&quot;</span><span class="p">)</span>
    <span class="n">glob</span><span class="o">.</span><span class="n">SILENT</span> <span class="o">=</span> <span class="kc">True</span>
    <span class="k">return</span> <span class="kc">True</span>


<span class="k">def</span> <span class="nf">start_print</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;(re)start printing user feedback</span>

<span class="sd">    Returns:</span>
<span class="sd">        True</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Printing user feedback set to &#39;True&#39;.&quot;</span><span class="p">)</span>
    <span class="n">glob</span><span class="o">.</span><span class="n">SILENT</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="k">return</span> <span class="kc">True</span>


<span class="k">def</span> <span class="nf">list_models</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;Print or return a list of all supported models.</span>

<span class="sd">    Returns:</span>
<span class="sd">        A dictionary detailing the supported models</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">glob</span><span class="o">.</span><span class="n">SUPPORTED_MODELS</span><span class="p">:</span>
        <span class="n">_load_supported_models</span><span class="p">()</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="n">glob</span><span class="o">.</span><span class="n">SILENT</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Currently supported models:&quot;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">glob</span><span class="o">.</span><span class="n">SUPPORTED_MODELS</span><span class="p">,</span> <span class="n">sort_keys</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">indent</span><span class="o">=</span><span class="mi">4</span><span class="p">))</span>

    <span class="k">return</span> <span class="n">glob</span><span class="o">.</span><span class="n">SUPPORTED_MODELS</span>


<span class="k">def</span> <span class="nf">_set_toolchain_URL</span><span class="p">(</span><span class="n">url</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;Change the location of the toolchain server.</span>

<span class="sd">    This function is internal and should not be used by average users of the package. However,</span>
<span class="sd">    it is useful for trouble-shooting the package either locally or on development servers.</span>

<span class="sd">    Args:</span>
<span class="sd">        url: String specifying the location of the toolchain server.</span>

<span class="sd">    Returns:</span>
<span class="sd">        str: The toolchains url.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">glob</span><span class="o">.</span><span class="n">TOOLCHAIN_URL</span> <span class="o">=</span> <span class="n">url</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="n">glob</span><span class="o">.</span><span class="n">SILENT</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Toolchain url changed to: &quot;</span> <span class="o">+</span> <span class="n">glob</span><span class="o">.</span><span class="n">TOOLCHAIN_URL</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">glob</span><span class="o">.</span><span class="n">TOOLCHAIN_URL</span>


<span class="k">def</span> <span class="nf">_set_usermanager_URL</span><span class="p">(</span><span class="n">url</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;Change the location of the toolchain server</span>

<span class="sd">    This function is internal and should not be used by average users of the package. However,</span>
<span class="sd">    it is useful for trouble-shooting the package either locally or on development servers.</span>

<span class="sd">    Args:</span>
<span class="sd">        url: String specifying the location of the toolchain server</span>

<span class="sd">    Returns:</span>
<span class="sd">        The user-manager url</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">glob</span><span class="o">.</span><span class="n">USER_MANAGER_URL</span> <span class="o">=</span> <span class="n">url</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="n">glob</span><span class="o">.</span><span class="n">SILENT</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;User-manager (admin) url changed to: &quot;</span> <span class="o">+</span> <span class="n">glob</span><span class="o">.</span><span class="n">USER_MANAGER_URL</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">glob</span><span class="o">.</span><span class="n">USER_MANAGER_URL</span>


<span class="k">def</span> <span class="nf">_toggle_debug_mode</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;Set debug to true or false.</span>

<span class="sd">    Can be used for debugging purposes such that exceptions are raised (including the stack trace)</span>
<span class="sd">    instead of suppressed.</span>

<span class="sd">    Note: the debug status is always printed when executing this method.</span>

<span class="sd">    Returns:</span>
<span class="sd">        Boolean indicating the status of the DEBUG global.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">glob</span><span class="o">.</span><span class="n">DEBUG</span><span class="p">:</span>
        <span class="n">glob</span><span class="o">.</span><span class="n">DEBUG</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Debugging turned off.&quot;</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">glob</span><span class="o">.</span><span class="n">DEBUG</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Debugging turned on.&quot;</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">glob</span><span class="o">.</span><span class="n">DEBUG</span>


<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s1">&#39;__main__&#39;</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;No command line options available for main.py.&quot;</span><span class="p">)</span>
</pre></div>

  </div>

  </header>

  <section id="section-items">

    <h2 class="section-title" id="header-functions">Functions</h2>
      
  <div class="item">
    <div class="name def" id="main.delete_endpoint">
    <p>def <span class="ident">delete_endpoint</span>(</p><p>cfid)</p>
    </div>
    

    
  
    <div class="desc"><p>Deletes an endpoint by cfid.</p>
<p>Delete an endpoint owned by the currently logged in user by cfid.</p>
<p>Args:
    cfid: String of the compute function id.</p>
<p>Returns:
    True if successful, False otherwise.</p>
<p>Raises  (in debug mode):
    JWTError if unable to obtain JWT authorization
    UserManagerError if unable to delete endpoints</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-main.delete_endpoint', this);">Show source &equiv;</a></p>
  <div id="source-main.delete_endpoint" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">delete_endpoint</span><span class="p">(</span><span class="n">cfid</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;Deletes an endpoint by cfid.</span>

<span class="sd">    Delete an endpoint owned by the currently logged in user by cfid.</span>

<span class="sd">    Args:</span>
<span class="sd">        cfid: String of the compute function id.</span>

<span class="sd">    Returns:</span>
<span class="sd">        True if successful, False otherwise.</span>

<span class="sd">    Raises  (in debug mode):</span>
<span class="sd">        JWTError if unable to obtain JWT authorization</span>
<span class="sd">        UserManagerError if unable to delete endpoints</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">_check_jwt</span><span class="p">()</span>
    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">glob</span><span class="o">.</span><span class="n">SILENT</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;We were unable to renew your JWT lease. </span><span class="se">\n</span><span class="s2">&quot;</span>
                  <span class="s2">&quot;If this recurs use the remove_credentials() function to reset your login credentials.&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">glob</span><span class="o">.</span><span class="n">DEBUG</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">JWTError</span><span class="p">(</span><span class="s2">&quot;Unable to check JWT authorization. &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">))</span>
        <span class="k">return</span> <span class="kc">False</span>

    <span class="n">url</span> <span class="o">=</span> <span class="n">glob</span><span class="o">.</span><span class="n">USER_MANAGER_URL</span> <span class="o">+</span> <span class="s2">&quot;/compute-function/&quot;</span> <span class="o">+</span> <span class="n">glob</span><span class="o">.</span><span class="n">JWT_USER_ID</span> <span class="o">+</span> <span class="s2">&quot;/&quot;</span> <span class="o">+</span> <span class="n">cfid</span>
    <span class="n">headers</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s1">&#39;Authorization&#39;</span><span class="p">:</span> <span class="n">glob</span><span class="o">.</span><span class="n">JWT_TOKEN</span>
    <span class="p">}</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">response</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">request</span><span class="p">(</span><span class="s2">&quot;DELETE&quot;</span><span class="p">,</span> <span class="n">url</span><span class="p">,</span> <span class="n">headers</span><span class="o">=</span><span class="n">headers</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="p">{})</span>
        <span class="c1"># Check if content type is JSON</span>
        <span class="k">if</span> <span class="s1">&#39;json&#39;</span> <span class="ow">in</span> <span class="n">response</span><span class="o">.</span><span class="n">headers</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;Content-Type&#39;</span><span class="p">):</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">result</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">text</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>  <span class="c1"># simplejson.decoder.JSONDecodeError</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">glob</span><span class="o">.</span><span class="n">SILENT</span><span class="p">:</span>
                    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Unable to decode JSON response from usermanager error.&quot;</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">glob</span><span class="o">.</span><span class="n">DEBUG</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="n">UserManagerError</span><span class="p">(</span><span class="n">result</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;Unable to decode JSON response from usermanager error.&quot;</span><span class="p">))</span>
                <span class="k">return</span> <span class="kc">False</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">glob</span><span class="o">.</span><span class="n">SILENT</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Server at&quot;</span><span class="p">,</span> <span class="n">glob</span><span class="o">.</span><span class="n">USER_MANAGER_URL</span><span class="p">,</span> <span class="s2">&quot;did not return a valid JSON document.&quot;</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">glob</span><span class="o">.</span><span class="n">DEBUG</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">UserManagerError</span><span class="p">(</span><span class="s2">&quot;Server at&quot;</span><span class="p">,</span> <span class="n">glob</span><span class="o">.</span><span class="n">USER_MANAGER_URL</span><span class="p">,</span> <span class="s2">&quot;did not return a valid JSON document.&quot;</span><span class="p">)</span>
            <span class="k">return</span> <span class="kc">False</span>
    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">glob</span><span class="o">.</span><span class="n">SILENT</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;We were unable to remove this endpoint from the server. </span><span class="se">\n</span><span class="s2">&quot;</span>
                  <span class="s2">&quot;Please try again later.&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">glob</span><span class="o">.</span><span class="n">DEBUG</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">UserManagerError</span><span class="p">(</span><span class="s2">&quot;Unable to delete endpoint. &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">))</span>
        <span class="k">return</span> <span class="kc">False</span>

    <span class="k">if</span> <span class="n">result</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;error&quot;</span><span class="p">)</span> <span class="o">!=</span> <span class="s2">&quot;&quot;</span><span class="p">:</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">glob</span><span class="o">.</span><span class="n">SILENT</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;We were unable to remove this endpoint: </span><span class="se">\n</span><span class="s2">&quot;</span>
                  <span class="s2">&quot;Server error: &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">result</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;error&quot;</span><span class="p">)))</span>
        <span class="k">if</span> <span class="n">glob</span><span class="o">.</span><span class="n">DEBUG</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">UserManagerError</span><span class="p">(</span><span class="s2">&quot;Unable to delete endpoint. &quot;</span> <span class="o">+</span> <span class="n">result</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;error&quot;</span><span class="p">))</span>
        <span class="k">return</span> <span class="kc">False</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="n">glob</span><span class="o">.</span><span class="n">SILENT</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Endpoint with cfid &quot;</span> <span class="o">+</span> <span class="n">cfid</span> <span class="o">+</span> <span class="s2">&quot; was successfully deleted.&quot;</span><span class="p">)</span>

    <span class="k">return</span> <span class="kc">True</span>
</pre></div>

  </div>
</div>

  </div>
  
      
  <div class="item">
    <div class="name def" id="main.endpoints">
    <p>def <span class="ident">endpoints</span>(</p><p>_verbose=True)</p>
    </div>
    

    
  
    <div class="desc"><p>Return the endpoints available for the current user.</p>
<p>Using the global JWT string this function returns a dict
of the endpoints by the current user.</p>
<p>Args:
    _verbose: Bool indicating whether the endpoints should be printed. Default True.</p>
<p>Returns:
     endpoints: a list containing all the endpoints by the current user. [{},{},{}]</p>
<p>Raises (in debug mode):
    JWTError if unable to obtain JWT authorization
    UserManagerError if unable to retrieve endpoint details</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-main.endpoints', this);">Show source &equiv;</a></p>
  <div id="source-main.endpoints" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">endpoints</span><span class="p">(</span><span class="n">_verbose</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;Return the endpoints available for the current user.</span>

<span class="sd">    Using the global JWT string this function returns a dict</span>
<span class="sd">    of the endpoints by the current user.</span>

<span class="sd">    Args:</span>
<span class="sd">        _verbose: Bool indicating whether the endpoints should be printed. Default True.</span>

<span class="sd">    Returns:</span>
<span class="sd">         endpoints: a list containing all the endpoints by the current user. [{},{},{}]</span>

<span class="sd">    Raises (in debug mode):</span>
<span class="sd">        JWTError if unable to obtain JWT authorization</span>
<span class="sd">        UserManagerError if unable to retrieve endpoint details</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">_check_jwt</span><span class="p">()</span>
    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">glob</span><span class="o">.</span><span class="n">SILENT</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;We were unable to renew your JWT lease. </span><span class="se">\n</span><span class="s2">&quot;</span>
                  <span class="s2">&quot;If this recurs use the remove_credentials() function to reset your login credentials.&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">glob</span><span class="o">.</span><span class="n">DEBUG</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">JWTError</span><span class="p">(</span><span class="s2">&quot;Unable to check JWT authorization. &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">))</span>
        <span class="k">return</span> <span class="kc">False</span>

    <span class="n">url</span> <span class="o">=</span> <span class="n">glob</span><span class="o">.</span><span class="n">USER_MANAGER_URL</span> <span class="o">+</span> <span class="s2">&quot;/compute-functions/&quot;</span> <span class="o">+</span> <span class="n">glob</span><span class="o">.</span><span class="n">JWT_USER_ID</span>
    <span class="n">headers</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s1">&#39;Authorization&#39;</span><span class="p">:</span> <span class="n">glob</span><span class="o">.</span><span class="n">JWT_TOKEN</span>
    <span class="p">}</span>

    <span class="k">try</span><span class="p">:</span>
        <span class="n">response</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">request</span><span class="p">(</span><span class="s2">&quot;GET&quot;</span><span class="p">,</span> <span class="n">url</span><span class="p">,</span> <span class="n">headers</span><span class="o">=</span><span class="n">headers</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="p">{})</span>
        <span class="n">result</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">text</span><span class="p">)</span>
    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">glob</span><span class="o">.</span><span class="n">SILENT</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;We were unable retrieve your endpoints. </span><span class="se">\n</span><span class="s2">&quot;</span>
                  <span class="s2">&quot;Please try again later.&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">glob</span><span class="o">.</span><span class="n">DEBUG</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">UserManagerError</span><span class="p">(</span><span class="s2">&quot;Unable to retrieve endpoints. &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">))</span>
        <span class="k">return</span> <span class="kc">False</span>

    <span class="c1"># print if requested:</span>
    <span class="k">if</span> <span class="n">_verbose</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">glob</span><span class="o">.</span><span class="n">SILENT</span><span class="p">:</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">result</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;You currently do not own any active endpoints.&quot;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;You currently own the following endpoints:&quot;</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">result</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Name: </span><span class="si">{}</span><span class="s1">, cfid: </span><span class="si">{}</span><span class="s1">.&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">key</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">],</span> <span class="n">key</span><span class="p">[</span><span class="s1">&#39;cfid&#39;</span><span class="p">]))</span>

    <span class="k">return</span> <span class="n">result</span>
</pre></div>

  </div>
</div>

  </div>
  
      
  <div class="item">
    <div class="name def" id="main.list_models">
    <p>def <span class="ident">list_models</span>(</p><p>)</p>
    </div>
    

    
  
    <div class="desc"><p>Print or return a list of all supported models.</p>
<p>Returns:
    A dictionary detailing the supported models</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-main.list_models', this);">Show source &equiv;</a></p>
  <div id="source-main.list_models" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">list_models</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;Print or return a list of all supported models.</span>

<span class="sd">    Returns:</span>
<span class="sd">        A dictionary detailing the supported models</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">glob</span><span class="o">.</span><span class="n">SUPPORTED_MODELS</span><span class="p">:</span>
        <span class="n">_load_supported_models</span><span class="p">()</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="n">glob</span><span class="o">.</span><span class="n">SILENT</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Currently supported models:&quot;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">glob</span><span class="o">.</span><span class="n">SUPPORTED_MODELS</span><span class="p">,</span> <span class="n">sort_keys</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">indent</span><span class="o">=</span><span class="mi">4</span><span class="p">))</span>

    <span class="k">return</span> <span class="n">glob</span><span class="o">.</span><span class="n">SUPPORTED_MODELS</span>
</pre></div>

  </div>
</div>

  </div>
  
      
  <div class="item">
    <div class="name def" id="main.remove_credentials">
    <p>def <span class="ident">remove_credentials</span>(</p><p>_verbose=True)</p>
    </div>
    

    
  
    <div class="desc"><p>Remove your stored credentials.</p>
<p>Remove the .creds.json file that stores the username and password
of the current user.</p>
<p>Args:
    _verbose: Boolean indicator whether or not feedback should be printed. Default False.</p>
<p>Returns:
    True is user credentials are found and deleted. False otherwise (often because they were not found).</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-main.remove_credentials', this);">Show source &equiv;</a></p>
  <div id="source-main.remove_credentials" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">remove_credentials</span><span class="p">(</span><span class="n">_verbose</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;Remove your stored credentials.</span>

<span class="sd">    Remove the .creds.json file that stores the username and password</span>
<span class="sd">    of the current user.</span>

<span class="sd">    Args:</span>
<span class="sd">        _verbose: Boolean indicator whether or not feedback should be printed. Default False.</span>

<span class="sd">    Returns:</span>
<span class="sd">        True is user credentials are found and deleted. False otherwise (often because they were not found).</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># actual function in _utils.py to prevent circular includes.</span>
    <span class="n">removed</span> <span class="o">=</span> <span class="n">_remove_credentials</span><span class="p">()</span>
    <span class="k">if</span> <span class="n">removed</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">_verbose</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">glob</span><span class="o">.</span><span class="n">SILENT</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Successfully removed your user credentials.&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="kc">True</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">_verbose</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">glob</span><span class="o">.</span><span class="n">SILENT</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;No user credentials found.&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="kc">False</span>
</pre></div>

  </div>
</div>

  </div>
  
      
  <div class="item">
    <div class="name def" id="main.start_print">
    <p>def <span class="ident">start_print</span>(</p><p>)</p>
    </div>
    

    
  
    <div class="desc"><p>(re)start printing user feedback</p>
<p>Returns:
    True</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-main.start_print', this);">Show source &equiv;</a></p>
  <div id="source-main.start_print" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">start_print</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;(re)start printing user feedback</span>

<span class="sd">    Returns:</span>
<span class="sd">        True</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Printing user feedback set to &#39;True&#39;.&quot;</span><span class="p">)</span>
    <span class="n">glob</span><span class="o">.</span><span class="n">SILENT</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="k">return</span> <span class="kc">True</span>
</pre></div>

  </div>
</div>

  </div>
  
      
  <div class="item">
    <div class="name def" id="main.stop_print">
    <p>def <span class="ident">stop_print</span>(</p><p>_verbose=False)</p>
    </div>
    

    
  
    <div class="desc"><p>Stop ALL printing of user feedback from package.</p>
<p>Args:
    _verbose: Boolean indicator whether or not feedback should be printed. Default False.</p>
<p>Returns:
    True</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-main.stop_print', this);">Show source &equiv;</a></p>
  <div id="source-main.stop_print" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">stop_print</span><span class="p">(</span><span class="n">_verbose</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;Stop ALL printing of user feedback from package.</span>

<span class="sd">    Args:</span>
<span class="sd">        _verbose: Boolean indicator whether or not feedback should be printed. Default False.</span>

<span class="sd">    Returns:</span>
<span class="sd">        True</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">_verbose</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Printing user feedback set to &#39;False&#39;.&quot;</span><span class="p">)</span>
    <span class="n">glob</span><span class="o">.</span><span class="n">SILENT</span> <span class="o">=</span> <span class="kc">True</span>
    <span class="k">return</span> <span class="kc">True</span>
</pre></div>

  </div>
</div>

  </div>
  
      
  <div class="item">
    <div class="name def" id="main.update">
    <p>def <span class="ident">update</span>(</p><p>mod, feature_vector, cfid, docs={}, email=True, _keep=False)</p>
    </div>
    

    
  
    <div class="desc"><p>Updates an already existing model.</p>
<p>The update function is similar to the upload function in most respects (so, see its docs),
but instead of creating a new endpoint it overwrites the docs and model of an already exisitng
endpoint. Thus, there is an additional argument "cfid" providing the computeFunction Id
of the endpoint that needs to be updated. Use sp.list_models() to get a list of your already
existing endpoints.</p>
<p>Note: If you solely want to change the documentation of an endpoint, you can either use the
    update_docs() function or the online admin interface at https://admin.sclble.net.</p>
<p>Args:
    mod: The model to be uploaded.
    feature_vector: An example feature_vector for your model.
        (i.e., the first row of your training data X obtained using row = X[0,:])
    cfid: a string with a valid computeFunction ID.
    docs: A dict{} containing the fields 'name' and 'documentation'. Default {}.
    email: Bool indicating whether a confirmation email of a successful conversion should be send. Default True.
    _keep: Bool indicating whether the .gzipped file should be retained. Default False.</p>
<p>Returns:
    False if upload failed, true otherwise</p>
<p>Raises  (in debug mode):
    UploadModelError if unable to successfully bundle and upload the model.</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-main.update', this);">Show source &equiv;</a></p>
  <div id="source-main.update" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">update</span><span class="p">(</span><span class="n">mod</span><span class="p">,</span> <span class="n">feature_vector</span><span class="p">,</span> <span class="n">cfid</span><span class="p">,</span> <span class="n">docs</span><span class="o">=</span><span class="p">{},</span> <span class="n">email</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">_keep</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;Updates an already existing model.</span>

<span class="sd">    The update function is similar to the upload function in most respects (so, see its docs),</span>
<span class="sd">    but instead of creating a new endpoint it overwrites the docs and model of an already exisitng</span>
<span class="sd">    endpoint. Thus, there is an additional argument &quot;cfid&quot; providing the computeFunction Id</span>
<span class="sd">    of the endpoint that needs to be updated. Use sp.list_models() to get a list of your already</span>
<span class="sd">    existing endpoints.</span>

<span class="sd">    Note: If you solely want to change the documentation of an endpoint, you can either use the</span>
<span class="sd">        update_docs() function or the online admin interface at https://admin.sclble.net.</span>

<span class="sd">    Args:</span>
<span class="sd">        mod: The model to be uploaded.</span>
<span class="sd">        feature_vector: An example feature_vector for your model.</span>
<span class="sd">            (i.e., the first row of your training data X obtained using row = X[0,:])</span>
<span class="sd">        cfid: a string with a valid computeFunction ID.</span>
<span class="sd">        docs: A dict{} containing the fields &#39;name&#39; and &#39;documentation&#39;. Default {}.</span>
<span class="sd">        email: Bool indicating whether a confirmation email of a successful conversion should be send. Default True.</span>
<span class="sd">        _keep: Bool indicating whether the .gzipped file should be retained. Default False.</span>

<span class="sd">    Returns:</span>
<span class="sd">        False if upload failed, true otherwise</span>

<span class="sd">    Raises  (in debug mode):</span>
<span class="sd">        UploadModelError if unable to successfully bundle and upload the model.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">bundle</span> <span class="o">=</span> <span class="p">{}</span>

    <span class="c1"># Check model:</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">_check_model</span><span class="p">(</span><span class="n">mod</span><span class="p">):</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">glob</span><span class="o">.</span><span class="n">SILENT</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;FATAL: The model you are trying to upload is not (yet) supported or has not been fitted. </span><span class="se">\n</span><span class="s2">&quot;</span>
                  <span class="s2">&quot;Please see README.md for a list of supported models. </span><span class="se">\n</span><span class="s2">&quot;</span>
                  <span class="s2">&quot;Your models has not been uploaded. </span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">glob</span><span class="o">.</span><span class="n">DEBUG</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">UploadModelError</span><span class="p">(</span><span class="s2">&quot;The submitted model is not supported.&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="kc">False</span>
    <span class="n">bundle</span><span class="p">[</span><span class="s1">&#39;fitted_model&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">mod</span>

    <span class="c1"># check input vector and generate an example:</span>
    <span class="n">bundle</span><span class="p">[</span><span class="s1">&#39;example&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">if</span> <span class="n">feature_vector</span><span class="o">.</span><span class="n">any</span><span class="p">():</span>
        <span class="c1"># try prediction</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">output</span> <span class="o">=</span> <span class="n">_predict</span><span class="p">(</span><span class="n">mod</span><span class="p">,</span> <span class="n">feature_vector</span><span class="p">)</span>  <span class="c1"># predict raises error if unable to generate predcition</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">glob</span><span class="o">.</span><span class="n">SILENT</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;FATAL: We were unable to create an example inference. </span><span class="se">\n</span><span class="s2">&quot;</span>
                      <span class="s2">&quot;Your model has not been updated. </span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">glob</span><span class="o">.</span><span class="n">DEBUG</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">UploadModelError</span><span class="p">(</span><span class="s2">&quot;Unable to generate prediction: &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">))</span>
            <span class="k">return</span> <span class="kc">False</span>
        <span class="c1"># format data:</span>
        <span class="n">input_str</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;[[</span><span class="si">%s</span><span class="s1">]]&#39;</span> <span class="o">%</span> <span class="s1">&#39;, &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">feature_vector</span><span class="o">.</span><span class="n">tolist</span><span class="p">()])</span>
        <span class="n">example</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;input&#39;</span><span class="p">:</span> <span class="n">input_str</span><span class="p">,</span> <span class="s2">&quot;output&quot;</span><span class="p">:</span> <span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">output</span><span class="p">)}</span>
        <span class="n">bundle</span><span class="p">[</span><span class="s1">&#39;example&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">example</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">glob</span><span class="o">.</span><span class="n">SILENT</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;FATAL: You did not provide a required example instance. (see docs). </span><span class="se">\n</span><span class="s2">&quot;</span>
                  <span class="s2">&quot;Your model has not been updated. </span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="kc">False</span>

    <span class="c1"># check the docs:</span>
    <span class="n">bundle</span><span class="p">[</span><span class="s1">&#39;docs&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="n">docs_update</span> <span class="o">=</span> <span class="kc">True</span>
    <span class="k">if</span> <span class="n">docs</span><span class="p">:</span>
        <span class="n">bundle</span><span class="p">[</span><span class="s1">&#39;docs&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">docs</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">docs_update</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">glob</span><span class="o">.</span><span class="n">SILENT</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;WARNING: You did not provide any documentation. </span><span class="se">\n</span><span class="s2">&quot;</span>
                  <span class="s2">&quot;We will only update the .wasm model, not the documentation.&quot;</span><span class="p">)</span>

    <span class="c1"># check authorization:</span>
    <span class="n">auth</span> <span class="o">=</span> <span class="n">_check_jwt</span><span class="p">()</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">auth</span><span class="p">:</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">glob</span><span class="o">.</span><span class="n">SILENT</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;FATAL: We were unable to obtain JWT authorization for your account. </span><span class="se">\n</span><span class="s2">&quot;</span>
                  <span class="s2">&quot;Your model has not been updated. </span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">glob</span><span class="o">.</span><span class="n">DEBUG</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">UploadModelError</span><span class="p">(</span><span class="s2">&quot;We were unable to obtain JWT authorization.&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="kc">False</span>

    <span class="c1"># get system information</span>
    <span class="n">bundle</span><span class="p">[</span><span class="s1">&#39;system_info&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">_get_system_info</span><span class="p">()</span>

    <span class="c1"># gzip the bundle</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">_gzip_save</span><span class="p">(</span><span class="n">bundle</span><span class="p">):</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">glob</span><span class="o">.</span><span class="n">SILENT</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;FATAL: We were unable to gzip your model bundle. </span><span class="se">\n</span><span class="s2">&quot;</span>
                  <span class="s2">&quot;Your model has not been updated. </span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">glob</span><span class="o">.</span><span class="n">DEBUG</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">UploadModelError</span><span class="p">(</span><span class="s2">&quot;We were unable to save the bundle.&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="kc">False</span>

    <span class="c1"># all ok, upload:</span>
    <span class="k">if</span> <span class="n">auth</span><span class="p">:</span>

        <span class="n">url</span> <span class="o">=</span> <span class="n">glob</span><span class="o">.</span><span class="n">TOOLCHAIN_URL</span> <span class="o">+</span> <span class="s2">&quot;/upload/&quot;</span> <span class="o">+</span> <span class="n">glob</span><span class="o">.</span><span class="n">JWT_USER_ID</span> <span class="o">+</span> <span class="s2">&quot;/&quot;</span> <span class="o">+</span> <span class="n">cfid</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>

        <span class="c1"># Map python package to the right toolchain:</span>
        <span class="n">pkg_name</span> <span class="o">=</span> <span class="n">_get_model_package</span><span class="p">(</span><span class="n">mod</span><span class="p">)</span>
        <span class="n">toolchain_name</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
        <span class="k">if</span> <span class="n">pkg_name</span> <span class="o">==</span> <span class="s2">&quot;sklearn&quot;</span><span class="p">:</span>
            <span class="n">toolchain_name</span> <span class="o">=</span> <span class="s2">&quot;sklearn&quot;</span>
        <span class="k">elif</span> <span class="n">pkg_name</span> <span class="o">==</span> <span class="s2">&quot;statsmodels&quot;</span><span class="p">:</span>
            <span class="n">toolchain_name</span> <span class="o">=</span> <span class="s2">&quot;sklearn&quot;</span>
        <span class="k">elif</span> <span class="n">pkg_name</span> <span class="o">==</span> <span class="s2">&quot;xgboost&quot;</span><span class="p">:</span>
            <span class="n">toolchain_name</span> <span class="o">=</span> <span class="s2">&quot;sklearn&quot;</span>
        <span class="k">elif</span> <span class="n">pkg_name</span> <span class="o">==</span> <span class="s2">&quot;lightgbm&quot;</span><span class="p">:</span>
            <span class="n">toolchain_name</span> <span class="o">=</span> <span class="s2">&quot;sklearn&quot;</span>

        <span class="c1"># Setup the actual request</span>
        <span class="n">data</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s1">&#39;email&#39;</span><span class="p">:</span> <span class="n">email</span><span class="p">,</span>
            <span class="s1">&#39;package&#39;</span><span class="p">:</span> <span class="n">__version__</span><span class="p">,</span>
            <span class="s1">&#39;toolchain&#39;</span><span class="p">:</span> <span class="n">toolchain_name</span><span class="p">,</span>
            <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="n">bundle</span><span class="p">[</span><span class="s1">&#39;docs&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;name&#39;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">),</span>
            <span class="s1">&#39;docs&#39;</span><span class="p">:</span> <span class="n">bundle</span><span class="p">[</span><span class="s1">&#39;docs&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;documentation&#39;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">),</span>
            <span class="s1">&#39;updateDocs&#39;</span><span class="p">:</span> <span class="n">docs_update</span><span class="p">,</span>
            <span class="s1">&#39;exampleInput&#39;</span><span class="p">:</span> <span class="n">bundle</span><span class="p">[</span><span class="s1">&#39;example&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;input&#39;</span><span class="p">,</span> <span class="s2">&quot;[]&quot;</span><span class="p">),</span>
            <span class="s1">&#39;exampleOutput&#39;</span><span class="p">:</span> <span class="n">bundle</span><span class="p">[</span><span class="s1">&#39;example&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;output&#39;</span><span class="p">,</span> <span class="s2">&quot;[]&quot;</span><span class="p">)</span>
        <span class="p">}</span>
        <span class="n">payload</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s1">&#39;data&#39;</span><span class="p">:</span> <span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
        <span class="p">}</span>

        <span class="nb">print</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>

        <span class="n">files</span> <span class="o">=</span> <span class="p">[(</span><span class="s1">&#39;bundle&#39;</span><span class="p">,</span> <span class="nb">open</span><span class="p">(</span><span class="n">glob</span><span class="o">.</span><span class="n">GZIP_BUNDLE</span><span class="p">,</span> <span class="s1">&#39;rb&#39;</span><span class="p">))]</span>
        <span class="n">headers</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s1">&#39;Authorization&#39;</span><span class="p">:</span> <span class="n">glob</span><span class="o">.</span><span class="n">JWT_TOKEN</span>
        <span class="p">}</span>

        <span class="c1"># Do the request (and make sure to delete the gzip if errors occur)</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">response</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">put</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">headers</span><span class="o">=</span><span class="n">headers</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">payload</span><span class="p">,</span> <span class="n">files</span><span class="o">=</span><span class="n">files</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">glob</span><span class="o">.</span><span class="n">SILENT</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;FATAL: Unable to carry out the upload request: the toolchain is not available. </span><span class="se">\n</span><span class="s2">&quot;</span>
                      <span class="s2">&quot;Your model has not been updated. </span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">_keep</span><span class="p">:</span>
                <span class="n">_gzip_delete</span><span class="p">()</span>
            <span class="k">if</span> <span class="n">glob</span><span class="o">.</span><span class="n">DEBUG</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">UploadModelError</span><span class="p">(</span><span class="s2">&quot;We were unable to obtain JWT authorization: &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">))</span>
            <span class="k">return</span> <span class="kc">False</span>

        <span class="c1"># Error handling</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">response_data</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">text</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">glob</span><span class="o">.</span><span class="n">SILENT</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;FATAL: We did not receive a valid JSON response from the toolchain-server. </span><span class="se">\n</span><span class="s2">&quot;</span>
                      <span class="s2">&quot;Your model has not been updated. </span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">_keep</span><span class="p">:</span>
                <span class="n">_gzip_delete</span><span class="p">()</span>
            <span class="k">if</span> <span class="n">glob</span><span class="o">.</span><span class="n">DEBUG</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">UploadModelError</span><span class="p">(</span><span class="s2">&quot;We did not receive a valid response from the server: &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">))</span>
            <span class="k">return</span> <span class="kc">False</span>

        <span class="k">if</span> <span class="n">response_data</span><span class="p">[</span><span class="s1">&#39;error&#39;</span><span class="p">]:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">glob</span><span class="o">.</span><span class="n">SILENT</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;FATAL: An error was returned by the server. </span><span class="se">\n</span><span class="s2">&quot;</span>
                      <span class="s2">&quot;Your model has not been updated. </span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">_keep</span><span class="p">:</span>
                <span class="n">_gzip_delete</span><span class="p">()</span>
            <span class="k">if</span> <span class="n">glob</span><span class="o">.</span><span class="n">DEBUG</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">UploadModelError</span><span class="p">(</span><span class="s2">&quot;We did not receive a valid response from the server: &quot;</span> <span class="o">+</span> <span class="n">response_data</span><span class="p">[</span><span class="s1">&#39;error&#39;</span><span class="p">])</span>
            <span class="k">return</span> <span class="kc">False</span>

        <span class="k">if</span> <span class="n">glob</span><span class="o">.</span><span class="n">DEBUG</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;The following content has been send to the toolchain server:&quot;</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="n">bundle</span><span class="p">)</span>

        <span class="c1"># user feedback:</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">glob</span><span class="o">.</span><span class="n">SILENT</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Your model was successfully submitted for an update. </span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="c1"># remove bundle:</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">_keep</span><span class="p">:</span>
            <span class="n">_gzip_delete</span><span class="p">()</span>

        <span class="k">return</span> <span class="kc">True</span>

    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="kc">False</span>
</pre></div>

  </div>
</div>

  </div>
  
      
  <div class="item">
    <div class="name def" id="main.update_docs">
    <p>def <span class="ident">update_docs</span>(</p><p>cfid, docs)</p>
    </div>
    

    
  
    <div class="desc"><p>Updates the documentation of an already existing model</p>
<p>The update_docs function can be used to upload the documentation of an already existing model
by simply providing the cfid and the new docs object.</p>
<p>Args:
    cfid: a string with a valid computeFunction ID.
    docs: A dict{} containing the fields 'name' and 'documentation'</p>
<p>Returns:
    False if upload failed, true otherwise</p>
<p>Raises  (in debug mode):
    UploadModelError if unable to successfully bundle and upload the model.</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-main.update_docs', this);">Show source &equiv;</a></p>
  <div id="source-main.update_docs" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">update_docs</span><span class="p">(</span><span class="n">cfid</span><span class="p">,</span> <span class="n">docs</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;Updates the documentation of an already existing model</span>

<span class="sd">    The update_docs function can be used to upload the documentation of an already existing model</span>
<span class="sd">    by simply providing the cfid and the new docs object.</span>

<span class="sd">    Args:</span>
<span class="sd">        cfid: a string with a valid computeFunction ID.</span>
<span class="sd">        docs: A dict{} containing the fields &#39;name&#39; and &#39;documentation&#39;</span>

<span class="sd">    Returns:</span>
<span class="sd">        False if upload failed, true otherwise</span>

<span class="sd">    Raises  (in debug mode):</span>
<span class="sd">        UploadModelError if unable to successfully bundle and upload the model.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># check the docs:</span>
    <span class="n">name</span> <span class="o">=</span> <span class="n">docs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;name&#39;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">name</span> <span class="o">==</span> <span class="s2">&quot;&quot;</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;FATAL: Please make sure to add a name to your documentation (using the &#39;name&#39;) field </span><span class="se">\n</span><span class="s2">&quot;</span>
              <span class="s2">&quot;Your model documentation has not been updated. </span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="kc">False</span>
    <span class="n">documentation</span> <span class="o">=</span> <span class="n">docs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;documentation&#39;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">documentation</span> <span class="o">==</span> <span class="s2">&quot;&quot;</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;FATAL: Please make sure to your documentation (using the &#39;documentation&#39; field) </span><span class="se">\n</span><span class="s2">&quot;</span>
              <span class="s2">&quot;Your model documentation has not been updated. </span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="kc">False</span>

    <span class="c1"># check authorization:</span>
    <span class="n">auth</span> <span class="o">=</span> <span class="n">_check_jwt</span><span class="p">()</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">auth</span><span class="p">:</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">glob</span><span class="o">.</span><span class="n">SILENT</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;FATAL: We were unable to obtain JWT authorization for your account. </span><span class="se">\n</span><span class="s2">&quot;</span>
                  <span class="s2">&quot;Your model has not been uploaded. </span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">glob</span><span class="o">.</span><span class="n">DEBUG</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">UploadModelError</span><span class="p">(</span><span class="s2">&quot;We were unable to obtain JWT authorization.&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="kc">False</span>

    <span class="c1"># all ok, upload:</span>
    <span class="k">if</span> <span class="n">auth</span><span class="p">:</span>

        <span class="n">url</span> <span class="o">=</span> <span class="n">glob</span><span class="o">.</span><span class="n">USER_MANAGER_URL</span> <span class="o">+</span> <span class="s2">&quot;/compute-function/&quot;</span> <span class="o">+</span> <span class="n">glob</span><span class="o">.</span><span class="n">JWT_USER_ID</span> <span class="o">+</span> <span class="s2">&quot;/&quot;</span> <span class="o">+</span> <span class="n">cfid</span>

        <span class="c1"># Setup the actual request</span>
        <span class="n">data</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;language&quot;</span><span class="p">:</span> <span class="s2">&quot;WASM&quot;</span><span class="p">,</span>
            <span class="s2">&quot;public&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
            <span class="s2">&quot;profit&quot;</span><span class="p">:</span> <span class="mf">0.1</span><span class="p">,</span>
            <span class="s2">&quot;cycles&quot;</span><span class="p">:</span> <span class="mf">1.0</span><span class="p">,</span>
            <span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="n">name</span><span class="p">,</span>
            <span class="s2">&quot;docs&quot;</span><span class="p">:</span> <span class="n">documentation</span>
        <span class="p">}</span>
        <span class="n">payload</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s1">&#39;data&#39;</span><span class="p">:</span> <span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
        <span class="p">}</span>

        <span class="n">files</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">headers</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s1">&#39;Authorization&#39;</span><span class="p">:</span> <span class="n">glob</span><span class="o">.</span><span class="n">JWT_TOKEN</span>
        <span class="p">}</span>

        <span class="c1"># Do the request (and make sure to delete the gzip if errors occur)</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">response</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">put</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">headers</span><span class="o">=</span><span class="n">headers</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">payload</span><span class="p">,</span> <span class="n">files</span><span class="o">=</span><span class="n">files</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">glob</span><span class="o">.</span><span class="n">SILENT</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;FATAL: Unable to carry out the upload request: the toolchain is not available. </span><span class="se">\n</span><span class="s2">&quot;</span>
                      <span class="s2">&quot;Your model documentation has not been updated. </span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">glob</span><span class="o">.</span><span class="n">DEBUG</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">UploadModelError</span><span class="p">(</span><span class="s2">&quot;We were unable to obtain JWT authorization: &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">))</span>
            <span class="k">return</span> <span class="kc">False</span>

        <span class="c1"># Error handling</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">response_data</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">text</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">glob</span><span class="o">.</span><span class="n">SILENT</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;FATAL: We did not receive a valid JSON response from the toolchain-server. </span><span class="se">\n</span><span class="s2">&quot;</span>
                      <span class="s2">&quot;Your model documentation has not been updated. </span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">glob</span><span class="o">.</span><span class="n">DEBUG</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">UploadModelError</span><span class="p">(</span><span class="s2">&quot;We did not receive a valid response from the server: &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">))</span>
            <span class="k">return</span> <span class="kc">False</span>

        <span class="k">if</span> <span class="n">response_data</span><span class="p">[</span><span class="s1">&#39;error&#39;</span><span class="p">]:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">glob</span><span class="o">.</span><span class="n">SILENT</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;FATAL: An error was returned by the server. </span><span class="se">\n</span><span class="s2">&quot;</span>
                      <span class="s2">&quot;Your model documentation has not been updated. </span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">glob</span><span class="o">.</span><span class="n">DEBUG</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">UploadModelError</span><span class="p">(</span><span class="s2">&quot;We did not receive a valid response from the server: &quot;</span> <span class="o">+</span> <span class="n">response_data</span><span class="p">[</span><span class="s1">&#39;error&#39;</span><span class="p">])</span>
            <span class="k">return</span> <span class="kc">False</span>

        <span class="k">if</span> <span class="n">glob</span><span class="o">.</span><span class="n">DEBUG</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;The documentation for &quot;</span> <span class="o">+</span> <span class="n">cfid</span> <span class="o">+</span> <span class="s2">&quot; has been updated using:&quot;</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>

        <span class="c1"># user feedback:</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">glob</span><span class="o">.</span><span class="n">SILENT</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Your model documentation has been updated. </span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="kc">True</span>

    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="kc">False</span>
</pre></div>

  </div>
</div>

  </div>
  
      
  <div class="item">
    <div class="name def" id="main.upload">
    <p>def <span class="ident">upload</span>(</p><p>mod, feature_vector, docs={}, email=True, _keep=False)</p>
    </div>
    

    
  
    <div class="desc"><p>Uploads a fitted model to Scailable.</p>
<p>The upload function is the main workhorse of the sclblpy package.
The function first checks whether the supplied model is ok (part of the list and fitted).</p>
<p>Next, it checks whether an example row is provided and if so it creates the example
input and output .json objects.</p>
<p>Next, the docs are checked; if none are provided a warning is issued and a simple
name is provided based on the model type.</p>
<p>Subsequently, we package the whole thing, including details of the user system, into a
gzipped file that is stored on disc.</p>
<p>Finally the whole package is uploaded to the toolchain.</p>
<p>Note: This method prints user-feedback by default. This feedback can be suppressed by calling the
    stop_print() method.</p>
<p>Args:
    mod: The model to be uploaded.
    feature_vector: An example feature_vector for your model.
        (i.e., the first row of your training data X obtained using row = X[0,:])
    docs: A dict{} containing the fields 'name' and 'documentation'
    email: Bool indicating whether a confirmation email of a successful conversion should be send. Default True.
    _keep: Bool indicating whether the .gzipped file should be retained. Default False.</p>
<p>Returns:
    False if upload failed, true otherwise</p>
<p>Raises  (in debug mode):
    UploadModelError if unable to successfully bundle and upload the model.</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-main.upload', this);">Show source &equiv;</a></p>
  <div id="source-main.upload" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">upload</span><span class="p">(</span><span class="n">mod</span><span class="p">,</span> <span class="n">feature_vector</span><span class="p">,</span> <span class="n">docs</span><span class="o">=</span><span class="p">{},</span> <span class="n">email</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">_keep</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;Uploads a fitted model to Scailable.</span>

<span class="sd">    The upload function is the main workhorse of the sclblpy package.</span>
<span class="sd">    The function first checks whether the supplied model is ok (part of the list and fitted).</span>

<span class="sd">    Next, it checks whether an example row is provided and if so it creates the example</span>
<span class="sd">    input and output .json objects.</span>

<span class="sd">    Next, the docs are checked; if none are provided a warning is issued and a simple</span>
<span class="sd">    name is provided based on the model type.</span>

<span class="sd">    Subsequently, we package the whole thing, including details of the user system, into a</span>
<span class="sd">    gzipped file that is stored on disc.</span>

<span class="sd">    Finally the whole package is uploaded to the toolchain.</span>

<span class="sd">    Note: This method prints user-feedback by default. This feedback can be suppressed by calling the</span>
<span class="sd">        stop_print() method.</span>

<span class="sd">    Args:</span>
<span class="sd">        mod: The model to be uploaded.</span>
<span class="sd">        feature_vector: An example feature_vector for your model.</span>
<span class="sd">            (i.e., the first row of your training data X obtained using row = X[0,:])</span>
<span class="sd">        docs: A dict{} containing the fields &#39;name&#39; and &#39;documentation&#39;</span>
<span class="sd">        email: Bool indicating whether a confirmation email of a successful conversion should be send. Default True.</span>
<span class="sd">        _keep: Bool indicating whether the .gzipped file should be retained. Default False.</span>

<span class="sd">    Returns:</span>
<span class="sd">        False if upload failed, true otherwise</span>

<span class="sd">    Raises  (in debug mode):</span>
<span class="sd">        UploadModelError if unable to successfully bundle and upload the model.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">bundle</span> <span class="o">=</span> <span class="p">{}</span>

    <span class="c1"># Check model:</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">_check_model</span><span class="p">(</span><span class="n">mod</span><span class="p">):</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">glob</span><span class="o">.</span><span class="n">SILENT</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;FATAL: The model you are trying to upload is not (yet) supported or has not been fitted. </span><span class="se">\n</span><span class="s2">&quot;</span>
                  <span class="s2">&quot;Please see README.md for a list of supported models. </span><span class="se">\n</span><span class="s2">&quot;</span>
                  <span class="s2">&quot;Your models has not been uploaded. </span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">glob</span><span class="o">.</span><span class="n">DEBUG</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">UploadModelError</span><span class="p">(</span><span class="s2">&quot;The uploaded model is not supported.&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="kc">False</span>
    <span class="n">bundle</span><span class="p">[</span><span class="s1">&#39;fitted_model&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">mod</span>

    <span class="c1"># check input vector and generate an example:</span>
    <span class="n">bundle</span><span class="p">[</span><span class="s1">&#39;example&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">if</span> <span class="n">feature_vector</span><span class="o">.</span><span class="n">any</span><span class="p">():</span>
        <span class="c1"># try prediction</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">output</span> <span class="o">=</span> <span class="n">_predict</span><span class="p">(</span><span class="n">mod</span><span class="p">,</span> <span class="n">feature_vector</span><span class="p">)</span>  <span class="c1"># predict raises error if unable to generate predcition</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">glob</span><span class="o">.</span><span class="n">SILENT</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;FATAL: We were unable to create an example inference. </span><span class="se">\n</span><span class="s2">&quot;</span>
                      <span class="s2">&quot;Your model has not been uploaded. </span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">glob</span><span class="o">.</span><span class="n">DEBUG</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">UploadModelError</span><span class="p">(</span><span class="s2">&quot;Unable to generate prediction: &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">))</span>
            <span class="k">return</span> <span class="kc">False</span>
        <span class="c1"># format data:</span>
        <span class="n">input_str</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;[[</span><span class="si">%s</span><span class="s1">]]&#39;</span> <span class="o">%</span> <span class="s1">&#39;, &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">feature_vector</span><span class="o">.</span><span class="n">tolist</span><span class="p">()])</span>
        <span class="n">example</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;input&#39;</span><span class="p">:</span> <span class="n">input_str</span><span class="p">,</span> <span class="s2">&quot;output&quot;</span><span class="p">:</span> <span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">output</span><span class="p">)}</span>
        <span class="n">bundle</span><span class="p">[</span><span class="s1">&#39;example&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">example</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">glob</span><span class="o">.</span><span class="n">SILENT</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;FATAL: You did not provide a required example instance. (see docs). </span><span class="se">\n</span><span class="s2">&quot;</span>
                  <span class="s2">&quot;Your model has not been uploaded. </span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="kc">False</span>

    <span class="c1"># check the docs:</span>
    <span class="n">bundle</span><span class="p">[</span><span class="s1">&#39;docs&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">if</span> <span class="n">docs</span><span class="p">:</span>
        <span class="n">bundle</span><span class="p">[</span><span class="s1">&#39;docs&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">docs</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">try</span><span class="p">:</span>  <span class="c1"># This should work, but catching the exception just in case:</span>
            <span class="n">name</span> <span class="o">=</span> <span class="n">_get_model_name</span><span class="p">(</span><span class="n">mod</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
            <span class="n">name</span> <span class="o">=</span> <span class="s2">&quot;NAMELESS MODEL&quot;</span>
        <span class="n">bundle</span><span class="p">[</span><span class="s1">&#39;docs&#39;</span><span class="p">][</span><span class="s1">&#39;name&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">name</span>
        <span class="n">bundle</span><span class="p">[</span><span class="s1">&#39;docs&#39;</span><span class="p">][</span><span class="s1">&#39;documentation&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;-- EMPTY --&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">glob</span><span class="o">.</span><span class="n">SILENT</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;WARNING: You did not provide any documentation. </span><span class="se">\n</span><span class="s2">&quot;</span>
                  <span class="s2">&quot;We will simply use &quot;</span> <span class="o">+</span> <span class="n">name</span> <span class="o">+</span> <span class="s2">&quot; as its name without further documentation.&quot;</span><span class="p">)</span>

    <span class="c1"># check authorization:</span>
    <span class="n">auth</span> <span class="o">=</span> <span class="n">_check_jwt</span><span class="p">()</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">auth</span><span class="p">:</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">glob</span><span class="o">.</span><span class="n">SILENT</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;FATAL: We were unable to obtain JWT authorization for your account. </span><span class="se">\n</span><span class="s2">&quot;</span>
                  <span class="s2">&quot;Your model has not been uploaded. </span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">glob</span><span class="o">.</span><span class="n">DEBUG</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">UploadModelError</span><span class="p">(</span><span class="s2">&quot;We were unable to obtain JWT authorization.&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="kc">False</span>

    <span class="c1"># get system information</span>
    <span class="n">bundle</span><span class="p">[</span><span class="s1">&#39;system_info&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">_get_system_info</span><span class="p">()</span>

    <span class="c1"># gzip the bundle</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">_gzip_save</span><span class="p">(</span><span class="n">bundle</span><span class="p">):</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">glob</span><span class="o">.</span><span class="n">SILENT</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;FATAL: We were unable to gzip your model bundle. </span><span class="se">\n</span><span class="s2">&quot;</span>
                  <span class="s2">&quot;Your model has not been uploaded. </span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">glob</span><span class="o">.</span><span class="n">DEBUG</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">UploadModelError</span><span class="p">(</span><span class="s2">&quot;We were unable to save the bundle.&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="kc">False</span>

    <span class="c1"># all ok, upload:</span>
    <span class="k">if</span> <span class="n">auth</span><span class="p">:</span>

        <span class="n">url</span> <span class="o">=</span> <span class="n">glob</span><span class="o">.</span><span class="n">TOOLCHAIN_URL</span> <span class="o">+</span> <span class="s2">&quot;/upload/&quot;</span> <span class="o">+</span> <span class="n">glob</span><span class="o">.</span><span class="n">JWT_USER_ID</span>

        <span class="c1"># Map python package to the right toolchain:</span>
        <span class="n">pkg_name</span> <span class="o">=</span> <span class="n">_get_model_package</span><span class="p">(</span><span class="n">mod</span><span class="p">)</span>
        <span class="n">toolchain_name</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
        <span class="k">if</span> <span class="n">pkg_name</span> <span class="o">==</span> <span class="s2">&quot;sklearn&quot;</span><span class="p">:</span>
            <span class="n">toolchain_name</span> <span class="o">=</span> <span class="s2">&quot;sklearn&quot;</span>
        <span class="k">elif</span> <span class="n">pkg_name</span> <span class="o">==</span> <span class="s2">&quot;statsmodels&quot;</span><span class="p">:</span>
            <span class="n">toolchain_name</span> <span class="o">=</span> <span class="s2">&quot;sklearn&quot;</span>
        <span class="k">elif</span> <span class="n">pkg_name</span> <span class="o">==</span> <span class="s2">&quot;xgboost&quot;</span><span class="p">:</span>
            <span class="n">toolchain_name</span> <span class="o">=</span> <span class="s2">&quot;sklearn&quot;</span>
        <span class="k">elif</span> <span class="n">pkg_name</span> <span class="o">==</span> <span class="s2">&quot;lightgbm&quot;</span><span class="p">:</span>
            <span class="n">toolchain_name</span> <span class="o">=</span> <span class="s2">&quot;sklearn&quot;</span>

        <span class="c1"># Setup the actual request</span>
        <span class="n">data</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s1">&#39;email&#39;</span><span class="p">:</span> <span class="n">email</span><span class="p">,</span>
            <span class="s1">&#39;package&#39;</span><span class="p">:</span> <span class="n">__version__</span><span class="p">,</span>
            <span class="s1">&#39;toolchain&#39;</span><span class="p">:</span> <span class="n">toolchain_name</span><span class="p">,</span>
            <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="n">bundle</span><span class="p">[</span><span class="s1">&#39;docs&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;name&#39;</span><span class="p">,</span> <span class="s2">&quot;No name found.&quot;</span><span class="p">),</span>
            <span class="s1">&#39;docs&#39;</span><span class="p">:</span> <span class="n">bundle</span><span class="p">[</span><span class="s1">&#39;docs&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;documentation&#39;</span><span class="p">,</span> <span class="s2">&quot;No docs provided.&quot;</span><span class="p">),</span>
            <span class="s1">&#39;exampleInput&#39;</span><span class="p">:</span> <span class="n">bundle</span><span class="p">[</span><span class="s1">&#39;example&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;input&#39;</span><span class="p">,</span> <span class="s2">&quot;[]&quot;</span><span class="p">),</span>
            <span class="s1">&#39;exampleOutput&#39;</span><span class="p">:</span> <span class="n">bundle</span><span class="p">[</span><span class="s1">&#39;example&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;output&#39;</span><span class="p">,</span> <span class="s2">&quot;[]&quot;</span><span class="p">)</span>
        <span class="p">}</span>
        <span class="n">payload</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s1">&#39;data&#39;</span><span class="p">:</span> <span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
        <span class="p">}</span>

        <span class="n">files</span> <span class="o">=</span> <span class="p">[(</span><span class="s1">&#39;bundle&#39;</span><span class="p">,</span> <span class="nb">open</span><span class="p">(</span><span class="n">glob</span><span class="o">.</span><span class="n">GZIP_BUNDLE</span><span class="p">,</span> <span class="s1">&#39;rb&#39;</span><span class="p">))]</span>
        <span class="n">headers</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s1">&#39;Authorization&#39;</span><span class="p">:</span> <span class="n">glob</span><span class="o">.</span><span class="n">JWT_TOKEN</span>
        <span class="p">}</span>

        <span class="c1"># Do the request (and make sure to delete the gzip if errors occur)</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">response</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">post</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">headers</span><span class="o">=</span><span class="n">headers</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">payload</span><span class="p">,</span> <span class="n">files</span><span class="o">=</span><span class="n">files</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">glob</span><span class="o">.</span><span class="n">SILENT</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;FATAL: Unable to carry out the upload request: the toolchain is not available. </span><span class="se">\n</span><span class="s2">&quot;</span>
                      <span class="s2">&quot;Your model has not been uploaded. </span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">_keep</span><span class="p">:</span>
                <span class="n">_gzip_delete</span><span class="p">()</span>
            <span class="k">if</span> <span class="n">glob</span><span class="o">.</span><span class="n">DEBUG</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">UploadModelError</span><span class="p">(</span><span class="s2">&quot;We were unable to obtain JWT authorization: &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">))</span>
            <span class="k">return</span> <span class="kc">False</span>

        <span class="c1"># Error handling</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">response_data</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">text</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">glob</span><span class="o">.</span><span class="n">SILENT</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;FATAL: We did not receive a valid JSON response from the toolchain-server. </span><span class="se">\n</span><span class="s2">&quot;</span>
                      <span class="s2">&quot;Your model has not been uploaded. </span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">_keep</span><span class="p">:</span>
                <span class="n">_gzip_delete</span><span class="p">()</span>
            <span class="k">if</span> <span class="n">glob</span><span class="o">.</span><span class="n">DEBUG</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">UploadModelError</span><span class="p">(</span><span class="s2">&quot;We did not receive a valid response from the server: &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">))</span>
            <span class="k">return</span> <span class="kc">False</span>

        <span class="k">if</span> <span class="n">response_data</span><span class="p">[</span><span class="s1">&#39;error&#39;</span><span class="p">]:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">glob</span><span class="o">.</span><span class="n">SILENT</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;FATAL: An error was returned by the server. </span><span class="se">\n</span><span class="s2">&quot;</span>
                      <span class="s2">&quot;Your model has not been uploaded. </span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">_keep</span><span class="p">:</span>
                <span class="n">_gzip_delete</span><span class="p">()</span>
            <span class="k">if</span> <span class="n">glob</span><span class="o">.</span><span class="n">DEBUG</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">UploadModelError</span><span class="p">(</span><span class="s2">&quot;We did not receive a valid response from the server: &quot;</span> <span class="o">+</span> <span class="n">response_data</span><span class="p">[</span><span class="s1">&#39;error&#39;</span><span class="p">])</span>
            <span class="k">return</span> <span class="kc">False</span>

        <span class="k">if</span> <span class="n">glob</span><span class="o">.</span><span class="n">DEBUG</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;The following content has been send to the toolchain server:&quot;</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="n">bundle</span><span class="p">)</span>

        <span class="c1"># user feedback:</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">glob</span><span class="o">.</span><span class="n">SILENT</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Your model was successfully uploaded. </span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="c1"># remove bundle:</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">_keep</span><span class="p">:</span>
            <span class="n">_gzip_delete</span><span class="p">()</span>

        <span class="k">return</span> <span class="kc">True</span>

    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="kc">False</span>
</pre></div>

  </div>
</div>

  </div>
  


  </section>

    </article>
  <div class="clear"> </div>
  <footer id="footer">
    <p>
      Documentation generated by
      <a href="https://github.com/BurntSushi/pdoc">pdoc 0.3.2</a>
    </p>

    <p>pdoc is in the public domain with the
      <a href="http://unlicense.org">UNLICENSE</a></p>

    <p>Design by <a href="http://nadh.in">Kailash Nadh</a></p>
  </footer>
</div>
</body>
</html>
